---
allowed-tools: >
  Bash(cat:*),
  Bash(echo:*),
  Bash(date:*),
  Bash(mkdir:*),
  Bash(ls:*),
  Read(*),
  Write(*),
  Glob(*),
  Grep(*)
description: |
  指定したドキュメントやコードに対して、多角的な視点から反論・質問・盲点を分析する。
  いろんな視点を踏まえて自分の意見を俯瞰し、レポートとしてまとめる。
---

## 引数

$ARGUMENTS

- 第1引数: 対象ファイルパス（docs/ 配下の Markdown やソースコード）
- 第2引数以降（オプション）: 分析の観点や追加コンテキスト

## 実行手順

### 1. 引数検証と対象ファイルの読み込み

- 第1引数でファイルパスを受け取り（必須）
  - ファイルが存在しない場合はエラー終了
  - ディレクトリが指定された場合は配下の主要ファイルを一括読み込み
- 第2引数以降で分析観点の追加指示があれば考慮
- 対象ファイルの内容を全て読み込む

### 2. [ultrathink] 多角的分析の実施

以下の **6つの視点** から徹底的に分析する:

#### 視点1: 技術的妥当性（Technical Validity）
- アーキテクチャの選定は適切か？代替案はないか？
- スケーラビリティ・パフォーマンスのボトルネックはないか？
- 技術的負債になりうる箇所はないか？
- エッジケースや障害シナリオが考慮されているか？

#### 視点2: ビジネス・ユーザー視点（Business & User Perspective）
- ユーザーの実際のニーズと乖離していないか？
- ビジネス要件の見落としはないか？
- 投資対効果（ROI）は妥当か？
- 優先順位の判断は適切か？

#### 視点3: セキュリティ・リスク（Security & Risk）
- セキュリティ上の脆弱性はないか？
- データプライバシーの考慮漏れはないか？
- 障害時のリカバリプランは十分か？
- コンプライアンス上の問題はないか？

#### 視点4: 保守性・拡張性（Maintainability & Extensibility）
- 将来の変更に対して柔軟か？
- コードやドキュメントの可読性は十分か？
- チームメンバーが理解・引き継ぎしやすい構成か？
- テスト戦略は十分か？

#### 視点5: 前提・暗黙の仮定（Assumptions & Blind Spots）
- 明文化されていない前提条件はないか？
- 「当たり前」として見過ごされていることはないか？
- 別のアプローチを検討した形跡はあるか？
- バイアスがかかっている判断はないか？

#### 視点6: ステークホルダーからの想定質問（Stakeholder Questions）
- 経営層からの質問: 「なぜこの方法なのか？」「いつ完成するのか？」
- 開発チームからの質問: 「なぜこの技術を選んだのか？」「テストは十分か？」
- 顧客からの質問: 「使い勝手は？」「既存機能への影響は？」
- 運用チームからの質問: 「監視は？」「障害対応は？」

### 3. 分析結果の構造化

分析結果を以下の優先度でカテゴリ分けする:

- **Critical（致命的）**: 今すぐ対処すべき問題
- **Important（重要）**: 進行前に検討すべき事項
- **Consider（検討推奨）**: 余裕があれば検討すべき事項
- **Nice to Have（参考情報）**: 知っておくと良い視点

### 4. レポートファイル生成

出力先: `tasks/review/` ディレクトリ（なければ作成）

ファイル名: `tasks/review/devil_advocate_{対象ファイル名}_{YYYYMMDD_HHMMSS}.md`

レポート構成:

```markdown
# 反論AI分析レポート

**対象**: {対象ファイルパス}
**分析日時**: {YYYY-MM-DD HH:MM}
**分析観点**: {指定された追加観点があれば記載}

---

## エグゼクティブサマリー

{3-5行で全体の評価と最も重要な指摘をまとめる}

---

## Critical（致命的）

### [C-1] {指摘タイトル}
- **視点**: {どの視点からの指摘か}
- **問題**: {具体的な問題の説明}
- **リスク**: {放置した場合のリスク}
- **提案**: {改善案}

---

## Important（重要）

### [I-1] {指摘タイトル}
...

---

## Consider（検討推奨）

### [R-1] {指摘タイトル}
...

---

## Nice to Have（参考情報）

### [N-1] {指摘タイトル}
...

---

## ステークホルダー想定Q&A

| # | 想定質問 | 現状の回答可否 | 推奨アクション |
|---|---------|--------------|--------------|
| 1 | ... | ... | ... |

---

## あなたが決めるべきこと（意思決定リスト）

分析の結果、以下の項目についてあなた自身の判断・意思決定が必要です。

| # | 決定事項 | 背景・なぜ決める必要があるか | 選択肢 | 推奨 | 期限感 |
|---|---------|--------------------------|--------|------|--------|
| D-1 | {決定すべきこと} | {この決定が必要な理由} | A: ... / B: ... / C: ... | {推奨案とその理由} | {今すぐ / 次フェーズまで / 余裕あり} |

### 決定の依存関係

{決定事項間の依存関係があれば記載。例: 「D-1を先に決めないとD-3に進めない」}

---

## 深掘りして考えるべきテーマ

以下は明確な答えがまだない、じっくり考える価値のあるテーマです。

### T-1: {テーマ}
- **問い**: {考えるべき問い}
- **なぜ重要か**: {このテーマを放置するとどうなるか}
- **考えるヒント**: {検討の出発点となる視点や参考情報}

---

## 俯瞰まとめ

{対象ドキュメント/コードの強みと弱みを俯瞰的にまとめる}

### 強み
- ...

### 改善余地
- ...

### 次のアクション（推奨）
1. ...
2. ...
3. ...
```

### 5. 完了ログ出力

- 生成したレポートファイルパスを表示
- Critical / Important の件数サマリーを表示
- 「レポートを確認して、対応が必要な項目を検討してください」と案内
