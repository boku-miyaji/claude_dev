---
allowed-tools: >
  Bash(git branch:*),
  Bash(git checkout:*),
  Bash(git add:*),
  Bash(git commit:*),
  Bash(echo:*),
  Bash(mkdir:*),
  Bash(cat:*),
  Write(*),
  MultiEdit(*)
description: |
  Issue IDを指定して、設計ドキュメントに基づいた実装を行う。
  機能ブランチの作成、コード実装、テスト実行、コミット、PR準備を含む。
---

## 実行手順 🤖

1. **引数検証と準備**

   - 第 1 引数で Issue ID を受け取り（必須）
   - 第 2 引数以降で追加の実装指示があれば考慮
   - GitHub 認証状態を確認
   - 対象タスクの状態が`Design`または`Dev`であることを確認

2. **機能ブランチの作成・切り替え**

   - ブランチ名: `feature/implement-{Issue ID}`
   - 既存ブランチがある場合は切り替え、無い場合は新規作成
     - 新規作成するときは最新の main ブランチから作成する
   - 開始時点のコミット ID を記録（ロールバック用）

3. **設計ドキュメント確認と実装**

   **状態が Design の場合:**

   - `tasks/design/{Issue ID}_*.md`の設計ドキュメントを読み込み
   - 設計内容をコンソールに表示
   - 設計に基づいて実装を実行:
     - ソースファイルの作成・修正
     - テストコードの作成（必須）
     - ドキュメント更新
     - プロジェクト規約に従った実装

   **状態が Dev の場合:**

   - `tasks/pr/{Issue ID}_*_review.md`のレビュー内容を読み込み
   - フィードバックに基づいて実装を修正

4. **テスト実行と品質チェック**

   - プロジェクトに応じたテストコマンドを実行
   - lint、型チェック等の品質チェック実行
   - テスト結果を確認してから次のステップへ

5. **変更のコミット**

   - 不要なファイル（履歴ファイル等）は除外
   - コミットメッセージは変更内容がわかるように作成
   - ローカルコミットのみ（プッシュしない）

6. **PR 関連ファイル作成**

   - `tasks/pr/`ディレクトリを作成
   - PR 説明ファイル`tasks/pr/{Issue ID}_{type}.md`を作成:
     - 実装した機能一覧
     - テスト結果
     - 変更ファイル一覧
   - PR レビューファイル`tasks/pr/{Issue ID}_{type}_review.md`を作成

7. **タスクステータス更新**

   - YAML ファイルを更新:
     - `state`を`Dev`に変更
     - `updatedAt`を現在時刻に更新
     - `implementation`情報（ブランチ、コミット）を追加
     - `pr`, `review`ファイルパスを追加
   - ファイル名を`tasks/{Issue ID}_Dev_{type}.yaml`にリネーム

8. **GitHub ラベル更新**

   - 状態が Design の場合: `Design`ラベルを削除、`Dev`ラベルを追加

9. **完了ログ出力**

   - ブランチ名とコミット状況を表示
   - 次のステップ（4-create-pr.md）への案内
