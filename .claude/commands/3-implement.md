---
allowed-tools: >
  Bash(git branch:*),
  Bash(git checkout:*),
  Bash(git add:*),
  Bash(git commit:*),
  Bash(echo:*),
  Bash(mkdir:*),
  Bash(cat:*),
  Write(*),
  MultiEdit(*)
description: |
  Issue IDを指定して、設計ドキュメントに基づいた実装を行う。
  機能ブランチの作成、コード実装、テスト実行、コミット、PR準備を含む。
---

## 引数

$ARGUMENTS

## 実行手順

1. **引数検証と準備**

   - 第 1 引数で Issue ID を受け取り（必須）
   - 第 2 引数以降で追加の実装指示があれば考慮
     全体の流れは 2 以降の手順に従ってください。（もし指示の中にスキップしてほしいなどがあれば、そこはスキップしてください）
   - GitHub 認証状態を確認
   - 対象タスクの状態が`Design`であることを確認

2. **機能ブランチの作成・切り替え**

   - ブランチ名: `feature/implement-{Issue ID}`
   - 既存ブランチがある場合は切り替え、無い場合は新規作成
     - 新規作成するときは最新の main ブランチから作成する

3. **設計ドキュメント確認と実装**

   - `tasks/design/{Issue ID}_*.md`の設計ドキュメントを読み込み
   - 設計内容をコンソールに表示
   - [ultrathink]設計に基づいて実装を実行:
     - ソースファイルの作成・修正
     - テストコードの作成
       - デグレがないようにテストを作成して機能が動作することを担保
     - ドキュメント更新
     - プロジェクト規約に従った実装

4. **テスト実行と品質チェック**

   - プロジェクトに応じたテストコマンドを実行
   - lint、型チェック等の品質チェック実行
   - テスト結果を確認してから次のステップへ

5. **変更のコミット**

   - 不要なファイル（履歴ファイル等）は除外
   - コミットメッセージは変更内容がわかるように作成
   - ローカルコミットのみ（プッシュしない）

6. **PR 関連ファイル作成**

   - `tasks/pr/`ディレクトリがなければ作成
   - 今回の実装の差分の要約を`tasks/pr/{YYYYMMDDHHMMSS}.md`に記録する（commit の差分を記載する）:
     - コミットの差分を要約してわかりやすく日本語で記載する。コードの差分を全て記載する必要はない。
   - PR 説明ファイル`tasks/pr/{Issue ID}_{type}.md`を作成/更新:
     - 実装した機能一覧
     - テスト結果
     - 変更ファイル一覧
     - この PR ファイルは commit 毎に記載するのではなく、対象の commit 全てを包括して記載する
     - [必須] 人間が最終チェックすべき項目

7. **PR レビューファイルを作成/更新**

   - [ultrathink]PR のレビューを世界最高峰のプログラマー視点で行う。可読性・保守性・拡張性を考慮してレビューする。
   - PR レビューファイル`tasks/pr/{Issue ID}_{type}_review.md`を作成
     - レビュー結果
     - 人間が動作確認すべきところを記載する

8. **タスクステータス更新**

   - YAML ファイルを更新:
     - `state`を`Dev`に変更
     - `updatedAt`を現在時刻に更新
     - `implementation`情報（ブランチ、コミット）を追加
     - `pr`, `review`ファイルパスを追加
   - ファイル名を`tasks/{Issue ID}_Dev_{type}.yaml`にリネーム

9. **GitHub ラベル更新**

   - 状態が Design の場合: `Design`ラベルを削除、`Dev`ラベルを追加(gh issue edit)

10. **完了ログ出力**

    - ブランチ名とコミット状況を表示
    - 次のステップ（4-reimplement.md or 6-push-pr.md）への案内
