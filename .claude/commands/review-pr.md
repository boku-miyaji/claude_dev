---
allowed-tools: >
  Bash(gh:*),
  Bash(git:*),
  Bash(cat:*),
  Bash(echo:*),
  Bash(date:*),
  Bash(mkdir:*),
  Bash(ls:*),
  Bash(cd:*),
  Read(*),
  Write(*),
  Glob(*),
  Grep(*),
  Task(*)
description: |
  PR番号を指定して、内容把握の要約とコードレビューを実施する。
  コード・ドキュメント・プロンプトの変更を網羅的にレビューし、Markdownレポートとして出力する。
---

## 引数

$ARGUMENTS

- 第1引数: PR番号（必須）例: `43`
- 第2引数以降（オプション）: レビューの重点ポイントや追加コンテキスト

## 実行手順

### 1. PR情報の取得

- `gh pr view {PR番号}` でPRの概要・説明・変更ファイル一覧を取得
- `gh pr diff {PR番号}` で差分を取得
- 変更ファイルをカテゴリ分類する:
  - **コード変更** (*.py, *.ts, *.js 等)
  - **ドキュメント変更** (*.md)
  - **設定変更** (*.yaml, *.json, *.toml 等)
  - **テスト変更** (tests/*, *_test.* 等)

### 2. PR内容の把握（サマリー作成）

[ultrathink] 以下の観点で変更の全体像を整理する:

- **変更の目的**: なぜこの変更が必要か（PRの説明・Issue参照から）
- **主要な変更点**: 新規追加・修正・削除の概要（箇条書き）
- **アーキテクチャへの影響**: 既存構造への影響度
- **変更の規模**: ファイル数、行数の増減
- **関連するIssue/PR**: 参照されているIssue番号

### 3. コードレビュー

[ultrathink] 各カテゴリのファイルについて以下を確認:

#### 3.1 コード品質

- 既存のコードパターン・命名規約との一貫性
- 型ヒント・シグネチャの正しさ
- エラーハンドリングの適切さ
- デッドコード・未使用importの有無
- セキュリティ上の懸念

#### 3.2 設計・アーキテクチャ

- SOLID原則への準拠
- 既存の抽象化・インターフェースとの整合性
- 依存関係の方向性
- テストの追加・更新の有無

#### 3.3 ドキュメント・プロンプト（該当する場合）

- コードとドキュメントの整合性
- 用語・表記の統一
- プロンプトの品質（明確性、網羅性、冗長性）
- フェーズ番号・参照の正しさ

### 4. 問題の分類と報告

発見した問題を以下の重要度で分類する:

| 重要度 | 基準 |
|--------|------|
| **Critical** | マージをブロックすべきバグ・セキュリティ問題 |
| **High** | マージ前に修正すべき問題（型不整合、ドキュメント不一致等） |
| **Medium** | 改善推奨（デッドコード、表記揺れ、遅延初期化等） |
| **Low** | 軽微な指摘（誤字、改行、スタイル等） |

### 5. Markdownレポート出力

- 出力先: `output/pr_reviews/PR_{PR番号}_review.md`
- レポート構成:
  1. **PR概要**: タイトル、作者、ブランチ、変更統計（テーブル形式）
  2. **変更サマリー**: 目的、主要変更点、アーキテクチャ影響、変更ファイルのカテゴリ分類
  3. **レビュー結果**: 重要度別のセクション（Critical/High → Medium → Low）
     - 各指摘にはファイルパス・問題の説明・影響・対応案を記載
     - High/Critical は個別見出し（`#### H-1: ...`）で詳述
     - Low はテーブル形式でまとめる
  4. **良い点**: コード品質、設計判断等の肯定的フィードバック（番号付きリスト）
  5. **総合評価**: 重要度別の件数テーブル、マージ可否の推奨と必須対応事項のリスト

### 6. コンソール出力

Markdownレポートのパスを表示し、以下の要約を出力:

```
## PR #{PR番号} レビュー完了

- Critical: X件
- High: X件
- Medium: X件
- Low: X件

推奨: {Approve / Request Changes / Comment}

詳細レポート: output/pr_reviews/PR_{PR番号}_review.md
```

## 注意事項

- レビュー対象のリポジトリで `gh` コマンドが使える前提
- 大規模なPR（差分が大きい場合）はTaskツールで並列にレビューを実行する
- プロジェクト固有のルール（CLAUDE.md等）がある場合はそれに従う
- レビュー結果をGitHub PRにコメントとして投稿する場合は、ユーザーに確認してから実行する
