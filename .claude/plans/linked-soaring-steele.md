# 回路図・ブロック図とレビュー結果の同時表示UI設計

## 概要

回路ブロック図・回路図のレビュー結果が別ウィンドウ（モーダル）で表示される問題を解決し、推論結果とレビュー結果を**同時に見れる**UIを実装する。

## 現状の問題

1. レビュー結果は `ReviewModal` や `DetailedCircuitReviewModal` でモーダル表示
2. モーダルが画面全体をオーバーレイするため、回路図を見ながらレビューを確認できない
3. ユーザーは図とレビューを交互に切り替えながら確認する必要がある

## 設計方針: ハイブリッドアプローチ

3つの表示モードを提供し、ユーザーが選択可能にする：

| モード | 説明 | 用途 |
|--------|------|------|
| **非表示** | レビュー結果を非表示 | 図のみに集中したい場合 |
| **インライン** | 図の下にレビュー結果を折りたたみ表示 | 簡易確認 |
| **分割表示** | 左に図、右にレビュー結果を並列表示 | 詳細比較（**推奨**） |
| **モーダル** | 既存のモーダル表示（維持） | フルスクリーンで詳細確認 |

## 実装計画

### Phase 1: コンテンツコンポーネントの抽出

既存のモーダルからコンテンツ部分を独立したコンポーネントとして抽出。

#### 1.1 ReviewContent.tsx（新規）
```
場所: frontend/src/components/review/ReviewContent.tsx
```
- `ReviewModal.tsx` から結果表示ロジックを抽出
- `variant: 'compact' | 'full'` でコンパクト/フル表示を切り替え
- モーダルなしで再利用可能に

#### 1.2 DetailedReviewContent.tsx（新規）
```
場所: frontend/src/components/review/DetailedReviewContent.tsx
```
- `DetailedCircuitReviewModal.tsx` から結果表示ロジックを抽出
- ブロック評価、BOM評価、統合図評価をインライン表示可能に

### Phase 2: 分割パネルコンポーネント作成

#### 2.1 ResizableSplitPanel.tsx（新規）
```
場所: frontend/src/components/ui/ResizableSplitPanel.tsx
```
- 左右または上下に分割可能
- ドラッグでリサイズ可能（20%〜80%範囲）
- Tailwind CSSのみで実装（外部依存なし）

### Phase 3: 表示モード切り替えUI

#### 3.1 ReviewViewModeToggle.tsx（新規）
```
場所: frontend/src/components/review/ReviewViewModeToggle.tsx
```
- 非表示/インライン/分割/モーダルの4モード切り替え
- アイコンボタンで直感的に操作
- レビュー結果がない場合は無効化

### Phase 4: パネルコンポーネント改修

#### 4.1 DiagramPanel.tsx（改修）
```
場所: frontend/src/components/workspace/DiagramPanel.tsx
```
変更内容：
- `reviewViewMode` state追加（'hidden' | 'inline' | 'split'）
- `ReviewViewModeToggle` をヘッダーに追加
- 分割表示時は `ResizableSplitPanel` を使用
- インライン表示時は図の下に `ReviewContent` を表示

#### 4.2 CircuitSchematicPanel.tsx（改修）
```
場所: frontend/src/components/workspace/CircuitSchematicPanel.tsx
```
変更内容：
- `reviewViewMode` state追加
- `DetailedReviewContent` を使用した分割/インライン表示

### Phase 5: 状態永続化（オプション）

#### 5.1 useReviewViewMode.ts（新規）
```
場所: frontend/src/hooks/useReviewViewMode.ts
```
- localStorageで表示モードを記憶
- ページ遷移後も設定を維持

## ファイル構成（実装後）

```
frontend/src/
├── components/
│   ├── review/
│   │   ├── ReviewModal.tsx               # 既存（モーダル用に維持）
│   │   ├── ReviewContent.tsx             # 新規: コンテンツ抽出
│   │   ├── DetailedCircuitReviewModal.tsx # 既存
│   │   ├── DetailedReviewContent.tsx     # 新規: コンテンツ抽出
│   │   ├── ReviewResultPanel.tsx         # 既存
│   │   ├── ReviewButton.tsx              # 既存
│   │   └── ReviewViewModeToggle.tsx      # 新規: モード切り替えUI
│   ├── ui/
│   │   └── ResizableSplitPanel.tsx       # 新規: 分割パネル
│   └── workspace/
│       ├── DiagramPanel.tsx              # 改修
│       └── CircuitSchematicPanel.tsx     # 改修
└── hooks/
    └── useReviewViewMode.ts              # 新規（オプション）
```

## UI設計イメージ

### 分割表示モード
```
┌──────────────────────────────────────────────────────────────┐
│ ブロック図パネル                    [非表示][インライン][分割][モーダル] │
├───────────────────────────┬──────────────────────────────────┤
│                           │                                  │
│  ┌─────────────────────┐  │  ┌────────────────────────────┐  │
│  │                     │  │  │ OpenAI レビュー結果        │  │
│  │   Mermaid 図        │  │  │ ◯ 12  △ 3  × 1            │  │
│  │                     │  │  │                            │  │
│  │                     │  │  │ [完全性] ◯ 問題なし       │  │
│  │                     │  │  │ [整合性] △ 要確認         │  │
│  │                     │  │  │ ...                        │  │
│  └─────────────────────┘  │  └────────────────────────────┘  │
│                           │  ┌────────────────────────────┐  │
│                           │  │ Gemini レビュー結果        │  │
│                           │  │ ...                        │  │
│                           │  └────────────────────────────┘  │
├─────────────────────────◀─┼─▶────────────────────────────────┤
│       リサイズハンドル     │                                  │
└──────────────────────────────────────────────────────────────┘
```

### インライン表示モード
```
┌──────────────────────────────────────────────────────────────┐
│ ブロック図パネル                    [非表示][インライン][分割][モーダル] │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │                    Mermaid 図                          │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│ ▼ レビュー結果                                               │
├──────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐ ┌─────────────────────┐            │
│  │ OpenAI: ◯12 △3 ×1  │ │ Gemini: ◯14 △2 ×0  │            │
│  └─────────────────────┘ └─────────────────────┘            │
└──────────────────────────────────────────────────────────────┘
```

## 実装順序

1. **ReviewContent.tsx** - ReviewModalからコンテンツ抽出
2. **DetailedReviewContent.tsx** - DetailedCircuitReviewModalからコンテンツ抽出
3. **ResizableSplitPanel.tsx** - 分割パネルコンポーネント
4. **ReviewViewModeToggle.tsx** - モード切り替えUI
5. **DiagramPanel.tsx** - 表示モード統合
6. **CircuitSchematicPanel.tsx** - 表示モード統合
7. **useReviewViewMode.ts** - 状態永続化（オプション）

## 検証方法

1. **機能テスト**
   - 各表示モード（非表示/インライン/分割/モーダル）が正しく動作する
   - 分割パネルのリサイズが滑らかに動作する
   - レビュー結果の表示内容が既存と一致する

2. **レスポンシブテスト**
   - 画面幅が狭い場合は分割表示を自動的にインラインに切り替え
   - モバイル端末での動作確認

3. **状態管理テスト**
   - 表示モードがページ遷移後も維持される
   - レビュー結果のキャッシュが正しく動作する

## リスクと対策

| リスク | 対策 |
|--------|------|
| 大きなレビュー結果が分割表示で見づらい | スクロール可能エリアを設け、compactバリアントを用意 |
| パフォーマンス低下 | CSS containmentを活用、必要な部分のみ再レンダリング |
| 既存機能への影響 | モーダル表示は完全に維持、段階的な移行が可能 |
