# モックシステム設計書

> **関連**: [設計書サマリ](00_summary.md) | [評価設計](05_evaluation_design.md) | [技術設計](06_technical_design.md)

---

## 1. 概要

### 1.1 目的

本モックシステムは、PoC期間中の**検証・評価・改善サイクル**を効率的に回すための検証プラットフォームである。
開発チームが以下を効率的に実行できることを目指す：

- AI出力結果の確認・評価
- プロンプトの管理・バージョニング
- ナレッジ・商材データの管理
- コスト・速度のモニタリング
- 改善サイクルの追跡

### 1.2 ユーザー

| ユーザー | 役割 | 主な使用機能 |
|----------|------|-------------|
| **開発者** | プロンプト改善、システム改良 | プロンプト管理、中間結果確認、コスト分析 |
| **評価担当者** | 出力品質の評価 | レビュー機能、評価結果確認 |
| **PM** | 進捗・品質把握 | ダッシュボード、レポート出力 |
| **rikyu担当者** | 評価参加、フィードバック | レビュー機能、結果確認 |

### 1.3 スコープ

```
┌─────────────────────────────────────────────────────────────────────┐
│                    モックシステム スコープ                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ✅ 含む                              ❌ 含まない                    │
│  ├─ 検証用UI                          ├─ 本番環境デプロイ           │
│  ├─ プロンプト管理                    ├─ セキュリティ対応          │
│  ├─ ナレッジ/データ管理               ├─ スケーラビリティ          │
│  ├─ 結果確認・評価機能                ├─ 外部システム連携          │
│  ├─ コスト・速度可視化                ├─ 高度なUI/UX              │
│  ├─ バージョン管理・固定              └─ マルチテナント           │
│  └─ 改善提案表示                                                    │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 2. システム構成

### 2.1 アーキテクチャ全体図

```
┌────────────────────────────────────────────────────────────────────────────────────────┐
│                              モックシステム アーキテクチャ                               │
├────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                        │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐  │
│  │                           Frontend (Streamlit)                                   │  │
│  │  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐           │  │
│  │  │ Dashboard │ │ Inference │ │ Data Mgmt │ │  Prompt   │ │  Review   │           │  │
│  │  │   Page    │ │   Page    │ │   Page    │ │   Page    │ │   Page    │           │  │
│  │  └───────────┘ └───────────┘ └───────────┘ └───────────┘ └───────────┘           │  │
│  └──────────────────────────────────────────────────────────────────────────────────┘  │
│                                           │                                            │
│                                           ▼                                            │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐  │
│  │                           Backend (FastAPI)                                      │  │
│  │  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐  │  │
│  │  │ InferenceAPI   │  │ DataAPI        │  │ PromptAPI      │  │ ReviewAPI      │  │  │
│  │  │ (推論実行)     │  │ (データ管理)   │  │ (プロンプト)   │  │ (評価管理)     │  │  │
│  │  └────────────────┘  └────────────────┘  └────────────────┘  └────────────────┘  │  │
│  │                                                                                  │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────┐    │  │
│  │  │                     Core Services                                        │    │  │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │    │  │
│  │  │  │ NeedsEstim   │  │ SolutionRec  │  │ AutoEval     │  │ CostTracker  │  │    │  │
│  │  │  │ ator         │  │ ommender     │  │ uator        │  │              │  │    │  │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘  │    │  │
│  │  └──────────────────────────────────────────────────────────────────────────┘    │  │
│  └──────────────────────────────────────────────────────────────────────────────────┘  │
│                          │                              │                              │
│              ┌───────────┴───────────┐      ┌──────────┴──────────┐                   │
│              ▼                       ▼      ▼                     ▼                   │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────────────────────┐  │
│  │  Azure OpenAI     │  │  Storage (SQLite  │  │  Tracer (Opik)                    │  │
│  │  (GPT-5.2)        │  │  / PostgreSQL)    │  │  - トレース                       │  │
│  │  - Chat API       │  │  - 実行履歴       │  │  - 評価記録                       │  │
│  │  - Embedding API  │  │  - プロンプト     │  │  - コスト・速度                   │  │
│  │                   │  │  - ナレッジ       │  │                                   │  │
│  └───────────────────┘  └───────────────────┘  └───────────────────────────────────┘  │
│                                                                                        │
└────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 技術スタック

| レイヤー | 技術 | 選定理由 |
|----------|------|----------|
| **Frontend** | Streamlit | 高速プロトタイピング、Python親和性 |
| **Backend** | FastAPI | 非同期処理、型安全、Swagger自動生成 |
| **Database** | SQLite (→PostgreSQL) | PoC段階は軽量SQLite、本番はPostgreSQL |
| **LLM** | Azure OpenAI (GPT-5.2) | 企業向け、セキュリティ |
| **Tracer** | Opik (抽象化レイヤー経由) | 評価追跡、LangFuse移行可能 |
| **ファイルストレージ** | ローカルFS / Azure Blob | PoC段階はローカル |

---

## 3. 機能一覧

### 3.1 機能マップ

```
┌─────────────────────────────────────────────────────────────────────┐
│                       モックシステム 機能マップ                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  📊 ダッシュボード                                                   │
│  ├─ 全体KPIサマリ（通過率、ハルシ率、コスト等）                     │
│  ├─ 日別推移グラフ                                                  │
│  └─ 最新実行結果一覧                                                │
│                                                                     │
│  🤖 推論実行                                                         │
│  ├─ 単発実行（1ケース）                                             │
│  ├─ バッチ実行（複数ケース）                                        │
│  ├─ 中間結果リアルタイム表示                                        │
│  └─ 対話的ブラッシュアップ                                          │
│                                                                     │
│  📁 データ管理                                                       │
│  ├─ ナレッジ管理（追加・編集・削除）                                │
│  ├─ 商材マスタ管理                                                  │
│  ├─ テストケース管理（100シナリオ）                                 │
│  └─ ドキュメント管理                                                │
│                                                                     │
│  📝 プロンプト管理                                                   │
│  ├─ プロンプト一覧・編集                                            │
│  ├─ バージョン管理（差分表示）                                      │
│  ├─ バージョン固定・タグ付け                                        │
│  └─ A/Bテスト設定                                                   │
│                                                                     │
│  🔌 エージェント・ツール管理                                         │
│  ├─ エージェント設定（NeedsEstimator, SolutionRecommender等）       │
│  ├─ ツール設定（データ取得、検索、ナレッジ参照等）                  │
│  ├─ パイプライン構成（エージェント間の接続フロー）                  │
│  └─ 出力スキーマ定義（JSON Schema編集）                             │
│                                                                     │
│  🧪 プロジェクト・実験管理                                           │
│  ├─ プロジェクト作成・切り替え                                      │
│  ├─ 実験管理（仮説・検証条件の設定）                                │
│  ├─ シナリオグループ（テストケースのグルーピング）                  │
│  ├─ スナップショット（設定の保存・復元）                            │
│  └─ 実験比較・レポート                                              │
│                                                                     │
│  📈 結果・評価                                                       │
│  ├─ 実行結果一覧（検索・フィルタ）                                  │
│  ├─ 詳細表示（入力・出力・中間結果）                                │
│  ├─ 自動評価結果（Layer1）                                          │
│  ├─ 人手評価登録（Layer3）                                          │
│  └─ 結果ダウンロード（CSV/JSON）                                    │
│                                                                     │
│  💰 コスト・パフォーマンス                                           │
│  ├─ プロセス別コスト表示                                            │
│  ├─ トークン使用量                                                  │
│  ├─ 処理時間（レイテンシ）                                          │
│  └─ コスト推移グラフ                                                │
│                                                                     │
│  🔧 改善提案                                                         │
│  ├─ 低評価ケース分析                                                │
│  ├─ 改善提案表示（自動生成）                                        │
│  └─ 改善履歴                                                        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 機能詳細

#### 3.2.1 ダッシュボード

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **KPIサマリ** | Layer1通過率、ハルシ率、平均コスト等を表示 | 高 |
| **推移グラフ** | 日別/プロンプトバージョン別のKPI推移 | 中 |
| **最新結果** | 直近N件の実行結果をクイック表示 | 高 |
| **アラート** | 異常値（ハルシ率急上昇等）をハイライト | 低 |

#### 3.2.2 推論実行

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **単発実行** | 1ケースを指定して推論を実行 | 高 |
| **バッチ実行** | 複数ケース（最大100件）を一括実行 | 高 |
| **中間結果表示** | AI①→AI②の各ステップの出力を確認 | 高 |
| **対話ブラッシュアップ** | ユーザーのフィードバックで出力を改善 | 中 |
| **バージョン指定実行** | 特定のプロンプトバージョンで実行 | 高 |

#### 3.2.3 データ管理

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **ナレッジ管理** | 過去事例・知見をアップロード・編集 | 高 |
| **商材マスタ** | 商品/サービス情報の追加・編集 | 高 |
| **テストケース** | 検証用100シナリオの管理 | 高 |
| **ドキュメント** | 補助資料のアップロード・参照 | 中 |
| **インポート/エクスポート** | CSV/JSON形式での一括操作 | 中 |

#### 3.2.4 プロンプト管理

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **プロンプト一覧** | 全LLMプロンプトの一覧表示 | 高 |
| **バージョン管理** | 変更履歴・差分表示（Git風） | 高 |
| **タグ付け** | 「baseline」「best_v2」等のラベル | 高 |
| **バージョン固定** | 特定バージョンを「固定」して再評価用に保持 | 高 |
| **A/Bテスト** | 2つのバージョンを比較実行 | 中 |

#### 3.2.5 結果・評価

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **結果一覧** | 全実行結果を検索・フィルタ | 高 |
| **詳細表示** | 入力→中間→出力の全データ表示 | 高 |
| **自動評価** | Layer1結果（ハルシ、矛盾等）の表示 | 高 |
| **人手評価登録** | Layer3評価（◯/△/×、コメント）の入力 | 高 |
| **一括ダウンロード** | CSV/JSON/Excelでエクスポート | 高 |
| **比較表示** | 2つの結果を並べて比較 | 中 |

#### 3.2.6 コスト・パフォーマンス

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **プロセス別コスト** | AI①/AI②/評価それぞれのコスト | 高 |
| **トークン詳細** | input/output別のトークン数 | 高 |
| **レイテンシ** | 各プロセスの処理時間 | 高 |
| **推移グラフ** | コスト・速度の時系列変化 | 中 |
| **予算アラート** | 設定した予算を超えた場合に警告 | 低 |

#### 3.2.7 改善提案

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **低評価分析** | ×判定が多いケースのパターン分析 | 中 |
| **自動改善提案** | LLMによる改善提案の自動生成 | 中 |
| **改善履歴** | 過去の改善とその効果の追跡 | 低 |

#### 3.2.8 エージェント・ツール管理

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **エージェント一覧** | 登録済みエージェントの一覧表示 | 高 |
| **エージェント設定** | 使用プロンプト、パラメータ、出力スキーマの編集 | 高 |
| **ツール一覧** | 登録済みツールの一覧表示 | 高 |
| **ツール設定** | ツールのパラメータ、接続先、制約の編集 | 高 |
| **パイプライン編集** | エージェント間の接続フローを可視化・編集 | 中 |
| **スキーマ編集** | 出力JSON Schemaのビジュアル編集 | 中 |

#### 3.2.9 プロジェクト・実験管理

| 機能 | 説明 | 優先度 |
|------|------|:------:|
| **プロジェクト管理** | プロジェクトの作成・切り替え・削除 | 高 |
| **実験作成** | 仮説・検証条件・使用設定を定義した実験を作成 | 高 |
| **シナリオグループ** | テストケースをグループ化して管理 | 高 |
| **スナップショット** | 現在の設定（プロンプト・エージェント・ツール）を保存 | 中 |
| **実験比較** | 複数の実験結果を並べて比較 | 中 |
| **レポート生成** | 実験結果のサマリレポートを自動生成 | 中 |

---

## 4. 画面設計

### 4.1 画面一覧

| # | 画面名 | パス | 説明 |
|---|--------|------|------|
| 1 | ダッシュボード | `/` | トップ、KPIサマリ |
| 2 | 推論実行 | `/inference` | 単発・バッチ実行 |
| 3 | 結果一覧 | `/results` | 実行結果の検索・一覧 |
| 4 | 結果詳細 | `/results/{id}` | 1件の詳細表示 |
| 5 | データ管理 | `/data` | ナレッジ・商材・ケース |
| 6 | プロンプト管理 | `/prompts` | プロンプト一覧・編集 |
| 7 | プロンプト詳細 | `/prompts/{id}` | バージョン履歴・編集 |
| 8 | レビュー | `/review` | 人手評価の入力 |
| 9 | コスト分析 | `/cost` | コスト・速度の可視化 |
| 10 | 改善提案 | `/improvements` | 改善提案の表示 |
| 11 | エージェント管理 | `/agents` | エージェント一覧・設定 |
| 12 | ツール管理 | `/tools` | ツール一覧・設定 |
| 13 | パイプライン | `/pipeline` | パイプライン可視化・編集 |
| 14 | プロジェクト管理 | `/projects` | プロジェクト一覧・切り替え |
| 15 | 実験管理 | `/experiments` | 実験作成・比較 |
| 16 | **営業支援UI** | `/sales` | 営業担当者向け提案支援画面 |

### 4.2 画面詳細設計

#### 4.2.1 ダッシュボード (`/`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  🏠 ダッシュボード                                          [日付範囲選択 ▼]   │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐              │
│  │ Layer1通過率 │ │ ハルシ率    │ │ 平均コスト  │ │ 実行件数    │              │
│  │   92.3%     │ │   3.2%     │ │  ¥42/件    │ │   156件     │              │
│  │   ↑ 1.2%   │ │   ↓ 0.5%  │ │   → 0%    │ │   ↑ 23件   │              │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘              │
│                                                                                │
│  ┌──────────────────────────────────┐  ┌─────────────────────────────────────┐│
│  │      📈 KPI推移グラフ            │  │      📋 最新実行結果                ││
│  │                                  │  │                                     ││
│  │  [Layer1通過率の日別推移]         │  │  ID    | 日時      | 評価 | コスト  ││
│  │                                  │  │  #156  | 01/22 14:30| ◯   | ¥45    ││
│  │  100% ─────────────────────────  │  │  #155  | 01/22 14:15| △   | ¥38    ││
│  │   90% ─────・─────・─────────    │  │  #154  | 01/22 13:45| ◯   | ¥42    ││
│  │   80% ─────────────────────────  │  │  #153  | 01/22 13:30| ×   | ¥51    ││
│  │        1/18  1/19  1/20  1/21    │  │  #152  | 01/22 13:00| ◯   | ¥39    ││
│  │                                  │  │                                     ││
│  │  [Tab: 通過率 | ハルシ率 | コスト]│  │                [もっと見る →]       ││
│  └──────────────────────────────────┘  └─────────────────────────────────────┘│
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  ⚠️ アラート                                                            │  │
│  │  • 01/22: プロンプトv3.2でハルシ率が5.1%に上昇（閾値5%超過）            │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.2 推論実行 (`/inference`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  🤖 推論実行                                                                   │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  [Tab: 単発実行 | バッチ実行 | 対話ブラッシュアップ]                           │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📋 入力設定                                                            │  │
│  │                                                                          │  │
│  │  テストケース:   [ケース選択 ▼] または [カスタム入力]                   │  │
│  │                                                                          │  │
│  │  プロンプトver:  [v3.2 (latest) ▼]  □ バージョン固定                   │  │
│  │  ナレッジ:       [デフォルト ▼]     [+ カスタム追加]                    │  │
│  │                                                                          │  │
│  │  ────────────────────────────────────────────────────────────────────── │  │
│  │  企業情報:                                                               │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 株式会社サンプル商事                                               │ │  │
│  │  │ 業種: 卸売業 / 年商: 50億円 / 従業員: 120名                        │ │  │
│  │  │ ...                                                                │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  面談記録:                                                               │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 2025/01/15 訪問メモ                                                │ │  │
│  │  │ 社長より海外展開に関心があるとの話あり...                          │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │                                    [実行 🚀]                             │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📤 実行結果                                                 [展開/折畳]│  │
│  │                                                                          │  │
│  │  ステータス: ✅ 完了 (3.2秒)                                            │  │
│  │                                                                          │  │
│  │  ┌── Step 1: ニーズ推定 (AI①) ────────────────────────────────────────┐ │  │
│  │  │  処理時間: 1.8秒 | トークン: 1,245 | コスト: ¥18                    │ │  │
│  │  │                                                                    │ │  │
│  │  │  【推定ニーズ】                                                    │ │  │
│  │  │  1. 海外展開支援 (優先度: 高)                                      │ │  │
│  │  │     根拠: 社長が海外展開に関心、アジア市場開拓の意向              │ │  │
│  │  │  2. 資金調達 (優先度: 中)                                          │ │  │
│  │  │     根拠: 設備投資計画あり、現状の借入余力から追加融資が必要      │ │  │
│  │  │  ...                                                               │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                              ↓                                          │  │
│  │  ┌── Step 2: ソリューション推薦 (AI②) ───────────────────────────────┐ │  │
│  │  │  処理時間: 1.4秒 | トークン: 1,890 | コスト: ¥24                    │ │  │
│  │  │                                                                    │ │  │
│  │  │  【提案方針】                                                      │ │  │
│  │  │  海外展開ニーズに対し、まず貿易金融サービスを軸に提案...          │ │  │
│  │  │                                                                    │ │  │
│  │  │  【推薦商材】                                                      │ │  │
│  │  │  1. 海外送金サービス / 2. 貿易保険 / 3. 設備投資融資             │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                              ↓                                          │  │
│  │  ┌── Step 3: 自動評価 (Layer1) ──────────────────────────────────────┐ │  │
│  │  │  ハルシネーション: ✅ Pass  | 論理整合性: ✅ Pass                  │ │  │
│  │  │  ニーズ網羅性: 4/5 (◯)    | 根拠妥当性: 4/5 (◯)                  │ │  │
│  │  │  総合評価: ◯                                                       │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  [詳細を見る] [結果をダウンロード ↓] [人手評価へ →]                     │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.3 プロンプト管理 (`/prompts`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  📝 プロンプト管理                                                             │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  プロンプト一覧                                        [+ 新規作成]      │  │
│  │                                                                          │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 名前                    │ 用途        │ 最新ver │ 固定ver │ 更新日  │ │  │
│  │  │─────────────────────────┼─────────────┼─────────┼─────────┼─────────│ │  │
│  │  │ needs_estimation_system │ AI① システム│ v3.2    │ v3.0🔒  │ 01/22   │ │  │
│  │  │ needs_estimation_user   │ AI① ユーザー│ v2.8    │ -       │ 01/21   │ │  │
│  │  │ solution_system         │ AI② システム│ v2.5    │ v2.3🔒  │ 01/20   │ │  │
│  │  │ solution_user           │ AI② ユーザー│ v2.1    │ -       │ 01/19   │ │  │
│  │  │ evaluation_judge        │ 評価用      │ v1.3    │ v1.0🔒  │ 01/18   │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📄 プロンプト詳細: needs_estimation_system                              │  │
│  │                                                                          │  │
│  │  バージョン履歴:                                                         │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ ver   │ 日時            │ 変更者   │ タグ     │ 操作              │ │  │
│  │  │───────┼─────────────────┼──────────┼──────────┼───────────────────│ │  │
│  │  │ v3.2  │ 01/22 14:00     │ 田中     │ latest   │ [表示] [固定]     │ │  │
│  │  │ v3.1  │ 01/21 10:30     │ 田中     │          │ [表示] [固定]     │ │  │
│  │  │ v3.0  │ 01/20 09:00     │ 鈴木     │ 🔒固定    │ [表示] [解除]     │ │  │
│  │  │ v2.9  │ 01/19 15:00     │ 田中     │          │ [表示] [固定]     │ │  │
│  │  │ ...                                                                │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  ┌── 差分表示: v3.1 → v3.2 ─────────────────────────────────────────┐   │  │
│  │  │ @@ -15,7 +15,9 @@                                                │   │  │
│  │  │  あなたは顧客ニーズ推定の専門家です。                           │   │  │
│  │  │  以下の情報を分析し、潜在的なニーズを推定してください。         │   │  │
│  │  │                                                                  │   │  │
│  │  │ -推定にあたっては、過去の類似事例を参考にしてください。         │   │  │
│  │  │ +推定にあたっては、以下の観点を重視してください：               │   │  │
│  │  │ +1. 過去の類似事例との比較                                      │   │  │
│  │  │ +2. 業界特有のニーズパターン                                    │   │  │
│  │  │ +3. 企業のライフステージ                                        │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                          │  │
│  │  [編集] [A/Bテスト設定] [バージョン間比較]                               │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.4 データ管理 (`/data`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  📁 データ管理                                                                 │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  [Tab: ナレッジ | 商材マスタ | テストケース | ドキュメント]                    │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📚 ナレッジ管理                      [+ 追加] [⬆️ インポート] [⬇️ 出力] │  │
│  │                                                                          │  │
│  │  検索: [                          🔍]  フィルタ: [カテゴリ ▼]           │  │
│  │                                                                          │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ ID    │ タイトル                  │ カテゴリ   │ 更新日   │ 操作   │ │  │
│  │  │───────┼───────────────────────────┼────────────┼──────────┼────────│ │  │
│  │  │ K001  │ 製造業の事業承継パターン  │ 事業承継   │ 01/20    │ [編集] │ │  │
│  │  │ K002  │ 卸売業の資金調達事例     │ 資金調達   │ 01/19    │ [編集] │ │  │
│  │  │ K003  │ 海外展開時の注意点       │ 海外展開   │ 01/18    │ [編集] │ │  │
│  │  │ K004  │ M&A成約事例（中小企業）   │ M&A       │ 01/17    │ [編集] │ │  │
│  │  │ ...                                                                │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  ─────────────────────────────────────────────────────────────────────── │  │
│  │                                                                          │  │
│  │  📝 ナレッジ編集: K001                                                   │  │
│  │                                                                          │  │
│  │  タイトル:  [製造業の事業承継パターン                        ]          │  │
│  │  カテゴリ:  [事業承継 ▼]                                                │  │
│  │  タグ:      [製造業] [中小企業] [+追加]                                 │  │
│  │                                                                          │  │
│  │  内容:                                                                   │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ ## 概要                                                            │ │  │
│  │  │ 製造業における事業承継では、以下のパターンが多い:                  │ │  │
│  │  │                                                                    │ │  │
│  │  │ 1. 親族内承継（60%）                                               │ │  │
│  │  │    - 子息への承継が最も多い                                        │ │  │
│  │  │    - 準備期間：平均5-7年                                           │ │  │
│  │  │ ...                                                                │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │                                      [キャンセル] [保存]                 │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.5 レビュー（人手評価） (`/review`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  📋 レビュー（人手評価）                                                       │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  評価対象選択                         ステータス: 15/50件 評価完了       │  │
│  │                                                                          │  │
│  │  表示:  [○ 未評価のみ | すべて]     並び順: [自動評価スコア ▼]         │  │
│  │                                                                          │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ ID    │ 企業名        │ 自動評価 │ 人手評価 │ 評価者   │ 操作     │ │  │
│  │  │───────┼───────────────┼──────────┼──────────┼──────────┼──────────│ │  │
│  │  │ #153  │ ○○商事       │ △ (3.2) │ -        │ -        │ [評価→] │ │  │
│  │  │ #148  │ △△工業       │ × (2.1) │ -        │ -        │ [評価→] │ │  │
│  │  │ #145  │ □□サービス   │ ◯ (4.5) │ ◯        │ 田中     │ [確認]  │ │  │
│  │  │ ...                                                                │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📝 評価入力: #153 ○○商事                                               │  │
│  │                                                                          │  │
│  │  ┌──────────────────────┐  ┌──────────────────────────────────────────┐ │  │
│  │  │ 【入力情報】         │  │ 【AI出力】                               │ │  │
│  │  │                      │  │                                          │ │  │
│  │  │ 企業: ○○商事        │  │ 【推定ニーズ】                           │ │  │
│  │  │ 業種: 卸売業         │  │ 1. 海外展開支援（高）                    │ │  │
│  │  │ 年商: 50億円         │  │ 2. 資金調達（中）                        │ │  │
│  │  │                      │  │ 3. 事業承継（中）                        │ │  │
│  │  │ 【面談記録】         │  │                                          │ │  │
│  │  │ 社長より海外展開に   │  │ 【提案方針】                             │ │  │
│  │  │ 関心があるとの話...  │  │ 海外展開ニーズに対し、貿易金融を軸に... │ │  │
│  │  │                      │  │                                          │ │  │
│  │  │ [全文表示]           │  │ [全文表示]                               │ │  │
│  │  └──────────────────────┘  └──────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │  │
│  │  │ 【評価入力】                                                     │   │  │
│  │  │                                                                  │   │  │
│  │  │ 総合評価:  (◯) そのまま使える  (△) 参考になる  (×) 使えない   │   │  │
│  │  │                                                                  │   │  │
│  │  │ 観点別評価:                                                      │   │  │
│  │  │ ├─ ニーズ網羅性:    [◯ ▼]   コメント: [                    ]   │   │  │
│  │  │ ├─ 根拠の妥当性:    [△ ▼]   コメント: [証跡が弱い部分あり  ]   │   │  │
│  │  │ ├─ 実用性:          [◯ ▼]   コメント: [                    ]   │   │  │
│  │  │ └─ 提案の適切さ:    [◯ ▼]   コメント: [                    ]   │   │  │
│  │  │                                                                  │   │  │
│  │  │ 総合コメント:                                                    │   │  │
│  │  │ ┌────────────────────────────────────────────────────────────┐   │   │  │
│  │  │ │ 海外展開のニーズは的確に捉えている。ただし、事業承継に     │   │   │  │
│  │  │ │ ついては社長の年齢からもう少し優先度を上げても良い。       │   │   │  │
│  │  │ └────────────────────────────────────────────────────────────┘   │   │  │
│  │  │                                                                  │   │  │
│  │  │                         [スキップ] [前へ] [保存して次へ →]       │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.6 コスト・パフォーマンス分析 (`/cost`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  💰 コスト・パフォーマンス分析                            [期間: 過去7日 ▼]   │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐              │
│  │ 総コスト    │ │ 平均コスト  │ │ 平均レイテンシ│ │ 総トークン  │              │
│  │  ¥6,552    │ │  ¥42/件    │ │   3.2秒     │ │  2.1M      │              │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘              │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📊 プロセス別内訳                                                      │  │
│  │                                                                          │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │  │
│  │  │ プロセス           │ 平均コスト │ 平均時間 │ 平均トークン │ 割合  │   │  │
│  │  │────────────────────┼────────────┼──────────┼──────────────┼───────│   │  │
│  │  │ AI① ニーズ推定    │ ¥18       │ 1.8秒    │ 1,250       │ 43%   │   │  │
│  │  │ AI② ソリューション │ ¥24       │ 1.4秒    │ 1,900       │ 57%   │   │  │
│  │  │ 自動評価 (Layer1)  │ ¥8        │ 0.8秒    │ 650         │ -     │   │  │
│  │  │────────────────────┼────────────┼──────────┼──────────────┼───────│   │  │
│  │  │ 合計               │ ¥50       │ 4.0秒    │ 3,800       │ 100%  │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📈 コスト推移                                                          │  │
│  │                                                                          │  │
│  │  ¥60 ─                                                                   │  │
│  │  ¥50 ─    ・─・─・───・                                                  │  │
│  │  ¥40 ─ ・─            ─・─・                                            │  │
│  │  ¥30 ─                                                                   │  │
│  │       ──────────────────────────────────────                             │  │
│  │       1/16  1/17  1/18  1/19  1/20  1/21  1/22                           │  │
│  │                                                                          │  │
│  │  [凡例: ─── 平均コスト  ─・─ プロンプト変更]                           │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  ⚙️ プロンプトバージョン別分析                                          │  │
│  │                                                                          │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │  │
│  │  │ バージョン │ 平均コスト │ 平均精度  │ コスパ      │ 実行数       │   │  │
│  │  │────────────┼────────────┼───────────┼─────────────┼──────────────│   │  │
│  │  │ v3.2       │ ¥45       │ 4.2/5     │ 0.093      │ 35件         │   │  │
│  │  │ v3.1       │ ¥42       │ 4.0/5     │ 0.095      │ 48件         │   │  │
│  │  │ v3.0 🔒    │ ¥38       │ 3.8/5     │ 0.100 ⭐    │ 73件         │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                          │  │
│  │  ※コスパ = 精度 / コスト（高いほど効率的）                               │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.7 改善提案 (`/improvements`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  🔧 改善提案                                                                   │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📊 低評価ケース分析                                                    │  │
│  │                                                                          │  │
│  │  直近7日間の×判定: 8件 / 156件 (5.1%)                                   │  │
│  │                                                                          │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │  │
│  │  │ 失敗パターン分類                                                 │   │  │
│  │  │                                                                  │   │  │
│  │  │  ■■■■■■■■■■ ハルシネーション (38%)                              │   │  │
│  │  │  ■■■■■■■    論理矛盾 (25%)                                       │   │  │
│  │  │  ■■■■■      ニーズ漏れ (25%)                                     │   │  │
│  │  │  ■■         その他 (12%)                                         │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  💡 自動生成された改善提案                               [再生成 🔄]     │  │
│  │                                                                          │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │  │
│  │  │ 📌 提案 #1: ハルシネーション対策（優先度: 高）                   │   │  │
│  │  │                                                                  │   │  │
│  │  │ 【問題】                                                         │   │  │
│  │  │ 商材名「ビジネスローンプレミアム」等、存在しない商品名を出力    │   │  │
│  │  │ している（3件）                                                  │   │  │
│  │  │                                                                  │   │  │
│  │  │ 【改善案】                                                       │   │  │
│  │  │ システムプロンプトに以下を追加:                                  │   │  │
│  │  │ 「推薦する商材は、必ず提供された商材マスタに存在するものに      │   │  │
│  │  │  限定してください。マスタにない商品名を出力しないでください。」 │   │  │
│  │  │                                                                  │   │  │
│  │  │ 【期待効果】                                                     │   │  │
│  │  │ ハルシネーション率: 5.1% → 2%以下                               │   │  │
│  │  │                                                                  │   │  │
│  │  │ [適用してテスト] [詳細を見る] [却下]                             │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                          │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │  │
│  │  │ 📌 提案 #2: 事業承継ニーズの検出強化（優先度: 中）               │   │  │
│  │  │                                                                  │   │  │
│  │  │ 【問題】                                                         │   │  │
│  │  │ 社長の年齢が60歳以上のケースで事業承継ニーズを見落としている    │   │  │
│  │  │ （2件）                                                          │   │  │
│  │  │                                                                  │   │  │
│  │  │ 【改善案】                                                       │   │  │
│  │  │ プロンプトに明示的なルールを追加:                                │   │  │
│  │  │ 「社長/代表者の年齢が60歳以上の場合、事業承継ニーズを必ず       │   │  │
│  │  │  検討項目に含めてください。」                                    │   │  │
│  │  │                                                                  │   │  │
│  │  │ [適用してテスト] [詳細を見る] [却下]                             │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📜 改善履歴                                                            │  │
│  │                                                                          │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │  │
│  │  │ 日付     │ 改善内容                    │ 効果              │ 状態 │   │  │
│  │  │──────────┼─────────────────────────────┼───────────────────┼──────│   │  │
│  │  │ 01/21    │ Few-shot例追加（海外展開）  │ 精度 +8%          │ ✅   │   │  │
│  │  │ 01/20    │ 商材マスタ参照の明示化      │ ハルシ率 -2.1%    │ ✅   │   │  │
│  │  │ 01/18    │ 出力フォーマット統一        │ 処理時間 -0.5秒   │ ✅   │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.8 エージェント管理 (`/agents`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  🤖 エージェント管理                                                           │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  [Tab: エージェント一覧 | ツール一覧 | パイプライン]                           │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  エージェント一覧                                        [+ 新規作成]    │  │
│  │                                                                          │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 名前              │ タイプ     │ 使用プロンプト │ 状態  │ 操作    │ │  │
│  │  │───────────────────┼────────────┼────────────────┼───────┼─────────│ │  │
│  │  │ NeedsEstimator    │ 推論       │ needs_* (v3.2) │ ✅有効 │ [編集]  │ │  │
│  │  │ SolutionRec       │ 推論       │ solution_* v2.5│ ✅有効 │ [編集]  │ │  │
│  │  │ AutoEvaluator     │ 評価       │ eval_* (v1.3)  │ ✅有効 │ [編集]  │ │  │
│  │  │ ImprovementGen    │ 改善生成   │ improve_* v1.0 │ ⚠️実験 │ [編集]  │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📝 エージェント編集: NeedsEstimator                                     │  │
│  │                                                                          │  │
│  │  基本設定:                                                               │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 名前:           [NeedsEstimator                                 ]  │ │  │
│  │  │ 説明:           [企業情報・面談記録からニーズを推定する          ]  │ │  │
│  │  │ タイプ:         [推論 ▼]                                           │ │  │
│  │  │ 状態:           (●) 有効  (○) 無効  (○) 実験中                    │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  プロンプト設定:                                                         │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ システムプロンプト: [needs_estimation_system ▼] ver: [v3.2 ▼]      │ │  │
│  │  │ ユーザープロンプト: [needs_estimation_user ▼]   ver: [v2.8 ▼]      │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  LLM設定:                                                                │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ モデル:         [gpt-5.2 ▼]                                        │ │  │
│  │  │ Temperature:    [0.3          ]  (0.0 - 2.0)                       │ │  │
│  │  │ Max Tokens:     [2000         ]                                    │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  出力スキーマ:                                         [エディタで編集] │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ {                                                                  │ │  │
│  │  │   "type": "object",                                                │ │  │
│  │  │   "properties": {                                                  │ │  │
│  │  │     "needs": { "type": "array", "items": {...} },                  │ │  │
│  │  │     "summary": { "type": "string" }                                │ │  │
│  │  │   }                                                                │ │  │
│  │  │ }                                                                  │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  使用ツール:                                         [+ ツール追加]     │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ ☑ KnowledgeRetriever  - ナレッジ検索                              │ │  │
│  │  │ ☑ SimilarCaseFinder   - 類似企業検索                              │ │  │
│  │  │ ☐ ProductSearch       - 商材検索                                  │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │                                        [キャンセル] [テスト実行] [保存] │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.9 ツール管理 (`/tools`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  🔧 ツール管理                                                                 │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  ツール一覧                                              [+ 新規作成]    │  │
│  │                                                                          │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 名前               │ タイプ     │ 使用対象         │ 状態 │ 操作  │ │  │
│  │  │────────────────────┼────────────┼──────────────────┼──────┼───────│ │  │
│  │  │ KnowledgeRetriever │ 検索       │ NeedsEstimator   │ ✅   │ [編集]│ │  │
│  │  │ SimilarCaseFinder  │ 検索       │ NeedsEstimator   │ ✅   │ [編集]│ │  │
│  │  │ ProductSearch      │ 検索       │ SolutionRec      │ ✅   │ [編集]│ │  │
│  │  │ HallucinationCheck │ 検証       │ AutoEvaluator    │ ✅   │ [編集]│ │  │
│  │  │ CompanyDataFetch   │ データ取得 │ 全エージェント   │ ✅   │ [編集]│ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📝 ツール編集: KnowledgeRetriever                                       │  │
│  │                                                                          │  │
│  │  基本設定:                                                               │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 名前:           [KnowledgeRetriever                             ]  │ │  │
│  │  │ 説明:           [登録ナレッジからの関連情報検索                  ]  │ │  │
│  │  │ タイプ:         [検索 ▼]                                           │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  検索設定:                                                               │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 検索方式:       (●) キーワード  (○) 意味検索(Embedding)           │ │  │
│  │  │ 対象ナレッジ:   [全カテゴリ ▼]                                     │ │  │
│  │  │ 最大取得件数:   [5            ]                                    │ │  │
│  │  │ 類似度閾値:     [0.7          ]  (Embedding使用時)                 │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  入力スキーマ:                                                           │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ {                                                                  │ │  │
│  │  │   "query": "string",        // 検索クエリ                          │ │  │
│  │  │   "category": "string?",    // カテゴリフィルタ（任意）            │ │  │
│  │  │   "limit": "number?"        // 取得件数（任意）                    │ │  │
│  │  │ }                                                                  │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │  出力スキーマ:                                                           │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ {                                                                  │ │  │
│  │  │   "results": [                                                     │ │  │
│  │  │     { "id": "string", "title": "string", "content": "string" }     │ │  │
│  │  │   ]                                                                │ │  │
│  │  │ }                                                                  │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │                                        [キャンセル] [テスト実行] [保存] │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.10 パイプライン (`/pipeline`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  🔀 パイプライン設計                                                           │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  パイプライン選択: [Default Pipeline ▼]          [+ 新規] [複製] [削除]  │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  パイプライン フロー図                                                   │  │
│  │                                                                          │  │
│  │        ┌─────────┐                                                      │  │
│  │        │  入力   │ ← 企業情報 + 面談記録                                │  │
│  │        └────┬────┘                                                      │  │
│  │             │                                                           │  │
│  │             ▼                                                           │  │
│  │    ┌─────────────────┐                                                  │  │
│  │    │ 🔧 DataEnricher │ ← 企業データの補完・整形                        │  │
│  │    └────────┬────────┘                                                  │  │
│  │             │                                                           │  │
│  │             ▼                                                           │  │
│  │    ┌─────────────────┐     ┌─────────────────┐                          │  │
│  │    │ 🤖 NeedsEstim   │────▶│ 🔧 Knowledge    │                          │  │
│  │    │    ator         │◀────│    Retriever    │                          │  │
│  │    └────────┬────────┘     └─────────────────┘                          │  │
│  │             │                                                           │  │
│  │             ▼ ニーズ一覧                                                │  │
│  │    ┌─────────────────┐     ┌─────────────────┐                          │  │
│  │    │ 🤖 SolutionRec  │────▶│ 🔧 ProductSearch│                          │  │
│  │    │    ommender     │◀────│                 │                          │  │
│  │    └────────┬────────┘     └─────────────────┘                          │  │
│  │             │                                                           │  │
│  │             ▼ 提案方針                                                  │  │
│  │    ┌─────────────────┐     ┌─────────────────┐                          │  │
│  │    │ 🤖 AutoEvaluator│────▶│ 🔧 Hallucination│                          │  │
│  │    │                 │◀────│    Check        │                          │  │
│  │    └────────┬────────┘     └─────────────────┘                          │  │
│  │             │                                                           │  │
│  │             ▼                                                           │  │
│  │        ┌─────────┐                                                      │  │
│  │        │  出力   │ → 推定ニーズ + 提案方針 + 評価結果                  │  │
│  │        └─────────┘                                                      │  │
│  │                                                                          │  │
│  │  [ノード選択で設定編集]  [ドラッグでノード追加]  [線をクリックで接続編集]│  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  ノード設定: NeedsEstimator                      [詳細設定へ →]        │  │
│  │                                                                          │  │
│  │  入力マッピング:                                                         │  │
│  │  ├─ company_info  ← DataEnricher.enriched_data.company                  │  │
│  │  └─ hearing_info  ← input.hearing_info                                  │  │
│  │                                                                          │  │
│  │  出力: needs_result (NeedsEstimationResult)                             │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│                                               [検証実行] [保存] [デプロイ]   │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.11 プロジェクト・実験管理 (`/projects`, `/experiments`)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  🧪 プロジェクト・実験管理                                                     │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  プロジェクト切り替え: [rikyu提案AI PoC ▼]  [+ 新規PJ] [PJ設定]        │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  実験一覧                                                [+ 新規実験]    │  │
│  │                                                                          │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 名前               │ 仮説                  │ 状態   │ 結果   │ 操作│ │  │
│  │  │────────────────────┼───────────────────────┼────────┼────────┼─────│ │  │
│  │  │ EXP-001 Baseline   │ 基準値測定            │ 完了   │ 78%    │ [→]│ │  │
│  │  │ EXP-002 Few-shot追加│ Few-shot例追加で+5%  │ 完了   │ 86% ↑  │ [→]│ │  │
│  │  │ EXP-003 RAG導入    │ RAGで類似事例精度向上 │ 実行中 │ -      │ [→]│ │  │
│  │  │ EXP-004 温度調整   │ temp=0.1で安定性向上  │ 計画中 │ -      │ [→]│ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📋 実験詳細: EXP-002 Few-shot追加                                       │  │
│  │                                                                          │  │
│  │  ┌── 実験設定 ──────────────────────────────────────────────────────┐   │  │
│  │  │                                                                  │   │  │
│  │  │  仮説:                                                           │   │  │
│  │  │  ┌────────────────────────────────────────────────────────────┐ │   │  │
│  │  │  │ Few-shot例を3件追加することで、ニーズ抽出精度が5%向上する │ │   │  │
│  │  │  └────────────────────────────────────────────────────────────┘ │   │  │
│  │  │                                                                  │   │  │
│  │  │  比較対象:   [EXP-001 Baseline ▼]                               │   │  │
│  │  │  使用シナリオ: [製造業グループ (25件) ▼]                        │   │  │
│  │  │                                                                  │   │  │
│  │  │  設定スナップショット:                                           │   │  │
│  │  │  ├─ プロンプト: needs_system v3.1 → v3.2 (Few-shot追加)        │   │  │
│  │  │  ├─ エージェント: NeedsEstimator 変更なし                        │   │  │
│  │  │  └─ ツール: 変更なし                                             │   │  │
│  │  │                                                                  │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                          │  │
│  │  ┌── 実験結果 ──────────────────────────────────────────────────────┐   │  │
│  │  │                                                                  │   │  │
│  │  │  ┌────────────────────────────────────────────────────────────┐ │   │  │
│  │  │  │ 指標           │ Baseline  │ この実験  │ 差分    │ 判定   │ │   │  │
│  │  │  │────────────────┼───────────┼───────────┼─────────┼────────│ │   │  │
│  │  │  │ Layer1通過率   │ 85%       │ 92%       │ +7%     │ ✅     │ │   │  │
│  │  │  │ ニーズ網羅性   │ 3.8/5     │ 4.2/5     │ +0.4    │ ✅     │ │   │  │
│  │  │  │ ハルシ率       │ 4.2%      │ 3.5%      │ -0.7%   │ ✅     │ │   │  │
│  │  │  │ 平均コスト     │ ¥42       │ ¥48       │ +¥6     │ ⚠️     │ │   │  │
│  │  │  └────────────────────────────────────────────────────────────┘ │   │  │
│  │  │                                                                  │   │  │
│  │  │  結論: 精度向上を確認、コスト増は許容範囲内 → 本番適用推奨       │   │  │
│  │  │                                                                  │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                          │  │
│  │  [比較グラフ表示] [詳細結果一覧] [設定を本番適用] [レポート出力]         │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📁 シナリオグループ管理                              [+ 新規グループ]  │  │
│  │                                                                          │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ グループ名          │ ケース数 │ 用途                │ 操作       │ │  │
│  │  │─────────────────────┼──────────┼─────────────────────┼────────────│ │  │
│  │  │ 全シナリオ          │ 100件    │ フル評価            │ [編集]     │ │  │
│  │  │ 製造業グループ      │ 25件     │ 業種別検証          │ [編集]     │ │  │
│  │  │ 高難易度グループ    │ 15件     │ 難易度検証          │ [編集]     │ │  │
│  │  │ 事業承継フォーカス  │ 20件     │ 特定ニーズ検証      │ [編集]     │ │  │
│  │  │ スモーク（5件）     │ 5件      │ クイック検証        │ [編集]     │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.12 営業支援UI (`/sales`) - 営業担当者向け

```
┌────────────────────────────────────────────────────────────────────────────────┐
│  💼 提案仮説構築AI                                        [ユーザー: 山田太郎]│
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📋 顧客情報入力                                                        │  │
│  │                                                                          │  │
│  │  顧客選択: [株式会社サンプル商事 ▼]           [新規顧客を追加]          │  │
│  │                                                                          │  │
│  │  ┌─────────────────────────────────┬────────────────────────────────────┐│  │
│  │  │ 【企業基本情報】                │ 【直近の面談記録】                 ││  │
│  │  │                                 │                                    ││  │
│  │  │ 企業名: 株式会社サンプル商事    │ 日付: 2025/01/15                   ││  │
│  │  │ 業種: 卸売業                    │                                    ││  │
│  │  │ 年商: 50億円                    │ ┌────────────────────────────────┐││  │
│  │  │ 従業員: 120名                   │ │ 社長（65歳）より海外展開に     │││  │
│  │  │ 設立: 1985年                    │ │ 関心があるとの話あり。         │││  │
│  │  │ 社長: 田中一郎（65歳）          │ │ 特にアジア市場（ベトナム、     │││  │
│  │  │                                 │ │ タイ）への進出を検討中。       │││  │
│  │  │ 取引状況:                       │ │ 後継者問題も少し話題に。       │││  │
│  │  │ ├─ 当行借入: 2億円              │ │                                │││  │
│  │  │ ├─ 預金残高: 5千万円            │ └────────────────────────────────┘││  │
│  │  │ └─ 取引年数: 15年               │                                    ││  │
│  │  │                                 │ [過去の面談履歴を見る]             ││  │
│  │  └─────────────────────────────────┴────────────────────────────────────┘│  │
│  │                                                                          │  │
│  │  追加情報（任意）:                                                       │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 競合状況、社長の性格、過去の提案履歴など自由に入力...              │ │  │
│  │  └────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                          │  │
│  │                                           [提案仮説を生成 🚀]            │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │  📊 提案仮説                                            [再生成] [保存] │  │
│  │                                                                          │  │
│  │  ┌── 推定ニーズ ────────────────────────────────────────────────────┐   │  │
│  │  │                                                                  │   │  │
│  │  │  ┌────────────────────────────────────────────────────────────┐ │   │  │
│  │  │  │ 🥇 海外展開支援 (優先度: 高)                      [詳細 ▼]│ │   │  │
│  │  │  │    根拠: 社長がアジア市場（ベトナム、タイ）進出を検討中    │ │   │  │
│  │  │  └────────────────────────────────────────────────────────────┘ │   │  │
│  │  │                                                                  │   │  │
│  │  │  ┌────────────────────────────────────────────────────────────┐ │   │  │
│  │  │  │ 🥈 事業承継準備 (優先度: 中)                      [詳細 ▼]│ │   │  │
│  │  │  │    根拠: 社長65歳、後継者問題が話題に                      │ │   │  │
│  │  │  └────────────────────────────────────────────────────────────┘ │   │  │
│  │  │                                                                  │   │  │
│  │  │  ┌────────────────────────────────────────────────────────────┐ │   │  │
│  │  │  │ 🥉 設備投資資金 (優先度: 中)                      [詳細 ▼]│ │   │  │
│  │  │  │    根拠: 海外展開に伴う設備投資が必要になる可能性          │ │   │  │
│  │  │  └────────────────────────────────────────────────────────────┘ │   │  │
│  │  │                                                                  │   │  │
│  │  │  [+ 追加で質問したいこと]                                        │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                          │  │
│  │  ┌── 提案方針 ──────────────────────────────────────────────────────┐   │  │
│  │  │                                                                  │   │  │
│  │  │  【方針】                                                        │   │  │
│  │  │  海外展開支援を軸に、段階的な取引深耕を図る。                    │   │  │
│  │  │  まずは貿易金融サービスの紹介から入り、海外進出支援の            │   │  │
│  │  │  パートナーとしてのポジションを確立。                            │   │  │
│  │  │  並行して事業承継についても長期的な視点で話題を継続。            │   │  │
│  │  │                                                                  │   │  │
│  │  │  【推薦商材】                                                    │   │  │
│  │  │  1. 海外送金サービス     - 輸出入の決済基盤として               │   │  │
│  │  │  2. 貿易保険             - 海外取引リスクのカバー               │   │  │
│  │  │  3. 設備投資融資         - 海外拠点設立時の資金                 │   │  │
│  │  │                                                                  │   │  │
│  │  │  【注意点】                                                      │   │  │
│  │  │  ⚠️ 競合B行も海外送金で積極アプローチ中との情報あり            │   │  │
│  │  │  ⚠️ 事業承継は社長が消極的な可能性、慎重にアプローチ           │   │  │
│  │  │                                                                  │   │  │
│  │  │  【類似成功事例】                                                │   │  │
│  │  │  📌 A社（卸売業・45億）: 同様のパターンで海外送金→融資→M&A    │   │  │
│  │  │     支援まで取引拡大（取引開始から3年で融資残高5億円増）        │   │  │
│  │  │                                                                  │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                          │  │
│  │  ┌── ブラッシュアップ ──────────────────────────────────────────────┐  │  │
│  │  │                                                                  │   │  │
│  │  │  修正・追加の指示:                                               │   │  │
│  │  │  ┌────────────────────────────────────────────────────────────┐ │   │  │
│  │  │  │ 例: 「与信上限があるので融資は除外して」                    │ │   │  │
│  │  │  │     「M&Aの可能性も含めて考えて」                           │ │   │  │
│  │  │  │     「もっと事業承継を深掘りして」                          │ │   │  │
│  │  │  └────────────────────────────────────────────────────────────┘ │   │  │
│  │  │                                                        [送信 📤] │   │  │
│  │  └──────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                          │  │
│  │  [PDFで出力] [メールで共有] [CRMに連携] [この提案を保存]                 │  │
│  └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. データモデル

### 5.1 ER図

#### 5.1.1 コア機能（プロンプト・推論・評価）

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                           コア機能 ER図（プロンプト・推論・評価）                               │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                             │
│  ┌──────────────────┐         ┌──────────────────┐                                          │
│  │ Prompt           │         │ PromptVersion    │                                          │
│  │──────────────────│ 1     * │──────────────────│                                          │
│  │ id               ├─────────┤ id               │                                          │
│  │ name             │         │ prompt_id        │                                          │
│  │ purpose          │         │ version          │                                          │
│  │ created_at       │         │ content          │                                          │
│  └──────────────────┘         │ is_locked        │                                          │
│         │                     │ tag              │                                          │
│         │ *                   │ created_at       │                                          │
│         ▼                     └──────────────────┘                                          │
│  ┌──────────────────┐                │                                                      │
│  │ Agent            │                │ *                                                    │
│  │──────────────────│        ┌───────┴──────────┐         ┌────────────────┐               │
│  │ id               │        │ ExecutionResult  │ 1     1 │ Review         │               │
│  │ name             │        │──────────────────├─────────┤────────────────│               │
│  │ type             │        │ id               │         │ id             │               │
│  │ system_prompt_id ├───────▶│ test_case_id     │         │ result_id      │               │
│  │ user_prompt_id   │        │ experiment_id    │         │ overall_rating │               │
│  │ model_config     │        │ prompt_versions  │         │ ratings (json) │               │
│  │ output_schema    │        │ input_data       │         │ comment        │               │
│  │ tool_ids (json)  │        │ output_data      │         │ reviewer       │               │
│  └──────────────────┘        │ intermediate     │         │ created_at     │               │
│         │                    │ auto_evaluation  │         └────────────────┘               │
│         │ *                  │ cost_info        │                                          │
│         ▼                    │ latency_info     │                                          │
│  ┌──────────────────┐        │ trace_id         │         ┌──────────────────┐             │
│  │ Tool             │        │ status           │         │ TestCase         │             │
│  │──────────────────│        │ created_at       │ *     1 │──────────────────│             │
│  │ id               │        └──────────────────┘─────────┤ id               │             │
│  │ name             │                                     │ name             │             │
│  │ type             │                                     │ company_info     │             │
│  │ config (json)    │                                     │ hearing_info     │             │
│  │ input_schema     │                                     │ expected_needs   │             │
│  │ output_schema    │                                     │ difficulty       │             │
│  │ status           │                                     │ tags (json)      │             │
│  └──────────────────┘                                     └──────────────────┘             │
│                                                                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 5.1.2 プロジェクト・実験管理

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                           プロジェクト・実験管理 ER図                                         │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                             │
│  ┌──────────────────┐                                                                       │
│  │ Project          │                                                                       │
│  │──────────────────│                                                                       │
│  │ id               │                                                                       │
│  │ name             │                                                                       │
│  │ description      │                                                                       │
│  │ is_active        │                                                                       │
│  │ created_at       │                                                                       │
│  └────────┬─────────┘                                                                       │
│           │ 1                                                                               │
│           │                                                                                 │
│     ┌─────┴─────┬───────────────────┐                                                       │
│     │ *         │ *                 │ *                                                     │
│     ▼           ▼                   ▼                                                       │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐                          │
│  │ Experiment       │  │ ScenarioGroup    │  │ Pipeline         │                          │
│  │──────────────────│  │──────────────────│  │──────────────────│                          │
│  │ id               │  │ id               │  │ id               │                          │
│  │ project_id       │  │ project_id       │  │ project_id       │                          │
│  │ name             │  │ name             │  │ name             │                          │
│  │ hypothesis       │  │ description      │  │ description      │                          │
│  │ baseline_exp_id  │──┤ test_case_ids    │  │ nodes (json)     │                          │
│  │ scenario_group_id│◀─│ created_at       │  │ edges (json)     │                          │
│  │ snapshot (json)  │  └──────────────────┘  │ is_default       │                          │
│  │ status           │                        │ created_at       │                          │
│  │ results (json)   │                        └──────────────────┘                          │
│  │ conclusion       │                               │                                       │
│  │ created_at       │                               │ nodes参照                             │
│  │ completed_at     │                               ▼                                       │
│  └──────────────────┘                        ┌──────────────────┐                          │
│           │                                  │ Agent / Tool     │                          │
│           │ 1                                │ （コア機能より） │                          │
│           │                                  └──────────────────┘                          │
│           │ *                                                                               │
│           ▼                                                                                 │
│  ┌──────────────────┐                                                                       │
│  │ ExecutionResult  │                                                                       │
│  │ （コア機能より） │                                                                       │
│  └──────────────────┘                                                                       │
│                                                                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 5.1.3 データ管理・営業支援

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                           データ管理・営業支援 ER図                                          │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                             │
│  ┌──────────────────┐         ┌──────────────────┐         ┌──────────────────┐            │
│  │ Knowledge        │         │ Product          │         │ Customer         │            │
│  │──────────────────│         │──────────────────│         │──────────────────│            │
│  │ id               │         │ id               │         │ id               │            │
│  │ title            │         │ name             │         │ company_name     │            │
│  │ category         │         │ category         │         │ industry         │            │
│  │ content          │         │ description      │         │ revenue          │            │
│  │ tags (json)      │         │ use_cases (json) │         │ employee_count   │            │
│  │ is_active        │         │ target_needs     │         │ president_info   │            │
│  │ created_at       │         │ metadata (json)  │         │ bank_relationship│            │
│  │ updated_at       │         │ is_active        │         │ notes            │            │
│  └──────────────────┘         └──────────────────┘         │ created_at       │            │
│                                                            └────────┬─────────┘            │
│                                                                     │ 1                    │
│                                                                     │                      │
│                                                                     │ *                    │
│                                                                     ▼                      │
│                                                            ┌──────────────────┐            │
│                                                            │ Proposal         │            │
│                                                            │──────────────────│            │
│                                                            │ id               │            │
│                                                            │ customer_id      │            │
│                                                            │ version          │            │
│                                                            │ needs_estimation │            │
│                                                            │ solution_rec     │            │
│                                                            │ feedback_history │            │
│                                                            │ status           │            │
│                                                            │ created_at       │            │
│                                                            │ updated_at       │            │
│                                                            └──────────────────┘            │
│                                                                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 テーブル定義

#### 5.2.1 Prompt（プロンプト）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| name | VARCHAR(100) | プロンプト名（一意） |
| purpose | VARCHAR(50) | 用途（needs_system, solution_user等） |
| description | TEXT | 説明 |
| created_at | TIMESTAMP | 作成日時 |

#### 5.2.2 PromptVersion（プロンプトバージョン）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| prompt_id | UUID | FK → Prompt |
| version | VARCHAR(20) | バージョン番号（v1.0, v1.1等） |
| content | TEXT | プロンプト本文 |
| is_locked | BOOLEAN | 固定フラグ |
| tag | VARCHAR(50) | タグ（latest, baseline等） |
| created_at | TIMESTAMP | 作成日時 |
| created_by | VARCHAR(100) | 作成者 |

#### 5.2.3 ExecutionResult（実行結果）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| test_case_id | UUID | FK → TestCase（NULL可＝カスタム入力） |
| prompt_versions | JSON | 使用したプロンプトバージョン群 |
| input_data | JSON | 入力データ全体 |
| output_data | JSON | 最終出力 |
| intermediate_results | JSON | 中間結果（AI①出力等） |
| auto_evaluation | JSON | Layer1自動評価結果 |
| cost_info | JSON | コスト情報 |
| latency_info | JSON | レイテンシ情報 |
| status | VARCHAR(20) | ステータス（success, failed, pending） |
| trace_id | VARCHAR(100) | Opikトレース ID |
| created_at | TIMESTAMP | 実行日時 |

```json
// cost_info の構造例
{
  "total_cost_yen": 45,
  "breakdown": {
    "needs_estimation": { "input_tokens": 800, "output_tokens": 450, "cost_yen": 18 },
    "solution_recommendation": { "input_tokens": 1200, "output_tokens": 700, "cost_yen": 24 },
    "auto_evaluation": { "input_tokens": 500, "output_tokens": 150, "cost_yen": 3 }
  }
}

// latency_info の構造例
{
  "total_seconds": 4.2,
  "breakdown": {
    "needs_estimation": 1.8,
    "solution_recommendation": 1.6,
    "auto_evaluation": 0.8
  }
}

// intermediate_results の構造例
{
  "needs_estimation": {
    "raw_output": "...",
    "parsed": { "needs": [...], "summary": "..." },
    "timestamp": "2025-01-22T14:30:00Z"
  },
  "solution_recommendation": {
    "raw_output": "...",
    "parsed": { "strategy": "...", "products": [...] },
    "timestamp": "2025-01-22T14:30:02Z"
  }
}
```

#### 5.2.4 Review（人手評価）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| result_id | UUID | FK → ExecutionResult |
| overall_rating | VARCHAR(10) | 総合評価（◯/△/×） |
| ratings | JSON | 観点別評価 |
| comment | TEXT | コメント |
| reviewer | VARCHAR(100) | 評価者 |
| created_at | TIMESTAMP | 評価日時 |

```json
// ratings の構造例
{
  "needs_coverage": { "rating": "◯", "comment": "" },
  "evidence_quality": { "rating": "△", "comment": "証跡が弱い部分あり" },
  "practicality": { "rating": "◯", "comment": "" },
  "solution_fit": { "rating": "◯", "comment": "" }
}
```

#### 5.2.5 Knowledge（ナレッジ）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| title | VARCHAR(200) | タイトル |
| category | VARCHAR(50) | カテゴリ |
| content | TEXT | 内容（Markdown可） |
| tags | JSON | タグ配列 |
| is_active | BOOLEAN | 有効フラグ |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

#### 5.2.6 Product（商材マスタ）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| name | VARCHAR(200) | 商品名 |
| category | VARCHAR(50) | カテゴリ |
| description | TEXT | 説明 |
| use_cases | JSON | 適用ユースケース |
| target_needs | JSON | 対象ニーズ |
| metadata | JSON | その他メタ情報 |
| is_active | BOOLEAN | 有効フラグ |

#### 5.2.7 TestCase（テストケース）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| name | VARCHAR(200) | ケース名 |
| company_info | JSON | 企業情報 |
| hearing_info | TEXT | ヒアリング情報 |
| expected_needs | JSON | 期待されるニーズ（正解データ） |
| expected_solutions | JSON | 期待されるソリューション |
| difficulty | VARCHAR(20) | 難易度（easy/medium/hard） |
| tags | JSON | タグ |
| is_active | BOOLEAN | 有効フラグ |

#### 5.2.8 Agent（エージェント）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| name | VARCHAR(100) | エージェント名（一意） |
| description | TEXT | 説明 |
| type | VARCHAR(50) | タイプ（inference/evaluation/improvement） |
| system_prompt_id | UUID | FK → Prompt（システムプロンプト） |
| user_prompt_id | UUID | FK → Prompt（ユーザープロンプト） |
| model_config | JSON | LLM設定（model, temperature, max_tokens等） |
| output_schema | JSON | 出力JSON Schema |
| tool_ids | JSON | 使用ツールID配列 |
| status | VARCHAR(20) | 状態（active/inactive/experimental） |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

```json
// model_config の構造例
{
  "model": "gpt-5.2",
  "temperature": 0.3,
  "max_tokens": 2000,
  "top_p": 1.0
}
```

#### 5.2.9 Tool（ツール）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| name | VARCHAR(100) | ツール名（一意） |
| description | TEXT | 説明 |
| type | VARCHAR(50) | タイプ（search/validation/data_fetch） |
| config | JSON | ツール固有の設定 |
| input_schema | JSON | 入力JSON Schema |
| output_schema | JSON | 出力JSON Schema |
| status | VARCHAR(20) | 状態（active/inactive） |
| created_at | TIMESTAMP | 作成日時 |

```json
// config の構造例（KnowledgeRetriever）
{
  "search_method": "keyword",  // or "embedding"
  "target_categories": ["all"],
  "max_results": 5,
  "similarity_threshold": 0.7
}
```

#### 5.2.10 Pipeline（パイプライン）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| name | VARCHAR(100) | パイプライン名 |
| description | TEXT | 説明 |
| nodes | JSON | ノード定義 |
| edges | JSON | エッジ（接続）定義 |
| is_default | BOOLEAN | デフォルトパイプラインか |
| project_id | UUID | FK → Project |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

```json
// nodes / edges の構造例
{
  "nodes": [
    { "id": "n1", "type": "agent", "agent_id": "uuid", "position": {"x": 100, "y": 100} },
    { "id": "n2", "type": "tool", "tool_id": "uuid", "position": {"x": 200, "y": 100} }
  ],
  "edges": [
    { "source": "n1", "target": "n2", "mapping": {"query": "output.needs[0].description"} }
  ]
}
```

#### 5.2.11 Project（プロジェクト）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| name | VARCHAR(200) | プロジェクト名 |
| description | TEXT | 説明 |
| is_active | BOOLEAN | 現在アクティブか |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

#### 5.2.12 Experiment（実験）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| project_id | UUID | FK → Project |
| name | VARCHAR(200) | 実験名 |
| hypothesis | TEXT | 仮説 |
| baseline_experiment_id | UUID | FK → Experiment（比較対象、NULL可） |
| scenario_group_id | UUID | FK → ScenarioGroup |
| snapshot | JSON | 設定スナップショット |
| status | VARCHAR(20) | 状態（planned/running/completed） |
| results | JSON | 実験結果 |
| conclusion | TEXT | 結論 |
| created_at | TIMESTAMP | 作成日時 |
| completed_at | TIMESTAMP | 完了日時 |

```json
// snapshot の構造例
{
  "prompt_versions": {
    "needs_system": "v3.2",
    "needs_user": "v2.8"
  },
  "agent_configs": {...},
  "tool_configs": {...},
  "pipeline_id": "uuid"
}

// results の構造例
{
  "metrics": {
    "layer1_pass_rate": 0.92,
    "needs_coverage": 4.2,
    "hallucination_rate": 0.035,
    "avg_cost": 48
  },
  "comparison": {
    "layer1_pass_rate": { "baseline": 0.85, "diff": "+0.07" },
    "needs_coverage": { "baseline": 3.8, "diff": "+0.4" }
  }
}
```

#### 5.2.13 ScenarioGroup（シナリオグループ）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| project_id | UUID | FK → Project |
| name | VARCHAR(200) | グループ名 |
| description | TEXT | 説明 |
| test_case_ids | JSON | テストケースID配列 |
| created_at | TIMESTAMP | 作成日時 |

#### 5.2.14 Customer（顧客 - 営業支援用）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| company_name | VARCHAR(200) | 企業名 |
| industry | VARCHAR(100) | 業種 |
| revenue | BIGINT | 年商（万円） |
| employee_count | INT | 従業員数 |
| established_year | INT | 設立年 |
| president_name | VARCHAR(100) | 代表者名 |
| president_age | INT | 代表者年齢 |
| bank_relationship | JSON | 取引状況 |
| address | VARCHAR(500) | 所在地 |
| notes | TEXT | 備考 |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

```json
// bank_relationship の構造例
{
  "loan_amount": 200000000,      // 借入金額（円）
  "deposit_amount": 50000000,   // 預金残高（円）
  "relationship_years": 15,     // 取引年数
  "main_services": ["融資", "預金"],
  "competitor_banks": ["B銀行", "C銀行"]
}
```

#### 5.2.15 Proposal（提案仮説 - 営業支援用）

| カラム名 | 型 | 説明 |
|----------|-----|------|
| id | UUID | 主キー |
| customer_id | UUID | FK → Customer |
| version | INT | バージョン番号（ブラッシュアップ回数） |
| input_data | JSON | 入力データ（企業情報・ヒアリング内容） |
| needs_estimation | JSON | ニーズ推定結果 |
| solution_recommendation | JSON | ソリューション推薦結果 |
| feedback_history | JSON | フィードバック履歴 |
| status | VARCHAR(20) | ステータス（draft/finalized/exported） |
| created_by | VARCHAR(100) | 作成者（営業担当者） |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

```json
// feedback_history の構造例
{
  "history": [
    {
      "version": 1,
      "timestamp": "2025-01-22T14:30:00Z",
      "feedback": null,                    // 初回生成
      "changes": null
    },
    {
      "version": 2,
      "timestamp": "2025-01-22T14:35:00Z",
      "feedback": "与信上限があるので融資は除外して",
      "feedback_category": "constraint_added",
      "changes": ["商材から融資を除外", "代替としてリースを追加"]
    },
    {
      "version": 3,
      "timestamp": "2025-01-22T14:40:00Z",
      "feedback": "もっと事業承継を深掘りして",
      "feedback_category": "topic_expansion",
      "changes": ["事業承継の優先度を高に変更", "後継者候補の確認質問を追加"]
    }
  ]
}

// needs_estimation の構造例
{
  "needs": [
    {
      "name": "海外展開支援",
      "priority": "high",
      "confidence": "high",
      "evidence": "社長がアジア市場（ベトナム、タイ）進出を検討中と発言",
      "similar_cases": ["A社（卸売業）で同様のケース→海外送金サービスで成約"]
    }
  ],
  "additional_questions": [
    {
      "question": "具体的な進出先国と時期は決まっていますか？",
      "reason": "国によって必要なサービスが異なるため"
    }
  ],
  "summary": "海外展開と事業承継が主要ニーズ。特に海外展開は具体的な検討段階。"
}

// solution_recommendation の構造例
{
  "strategy": "海外展開支援を軸に、段階的な取引深耕を図る。",
  "reasoning": "社長のアジア進出意欲が高く、当行の海外ネットワークを活用できる。",
  "cautions": [
    "競合B行も海外送金で積極アプローチ中",
    "事業承継は社長が消極的な可能性、慎重にアプローチ"
  ],
  "recommended_products": [
    {
      "name": "海外送金サービス",
      "target_need": "海外展開支援",
      "key_points": "アジア現地法人への送金手数料優遇",
      "similar_success_case": "A社（卸売業・45億）で同様のパターンで成約"
    }
  ],
  "similar_cases": [
    {
      "company_profile": "A社（卸売業・45億・従業員100名）",
      "needs": ["海外展開", "設備投資"],
      "proposal": "海外送金→融資→M&A支援",
      "result": "success",
      "lessons": "海外送金から入り、段階的に取引拡大"
    }
  ]
}
```

---

## 6. API設計

### 6.1 API一覧

| エンドポイント | メソッド | 説明 |
|----------------|----------|------|
| **推論** | | |
| `/api/inference/run` | POST | 単発推論実行 |
| `/api/inference/batch` | POST | バッチ推論実行 |
| `/api/inference/{id}/status` | GET | 実行ステータス確認 |
| **結果** | | |
| `/api/results` | GET | 結果一覧取得 |
| `/api/results/{id}` | GET | 結果詳細取得 |
| `/api/results/export` | POST | 結果エクスポート |
| **プロンプト** | | |
| `/api/prompts` | GET | プロンプト一覧 |
| `/api/prompts/{id}` | GET | プロンプト詳細 |
| `/api/prompts/{id}/versions` | GET | バージョン一覧 |
| `/api/prompts/{id}/versions` | POST | 新バージョン作成 |
| `/api/prompts/{id}/versions/{ver}/lock` | POST | バージョン固定 |
| **データ** | | |
| `/api/knowledge` | GET/POST | ナレッジ一覧/作成 |
| `/api/knowledge/{id}` | GET/PUT/DELETE | ナレッジ詳細 |
| `/api/products` | GET/POST | 商材一覧/作成 |
| `/api/testcases` | GET/POST | テストケース一覧/作成 |
| **レビュー** | | |
| `/api/reviews` | GET/POST | レビュー一覧/作成 |
| `/api/reviews/{id}` | GET/PUT | レビュー詳細/更新 |
| **分析** | | |
| `/api/analytics/dashboard` | GET | ダッシュボードデータ |
| `/api/analytics/cost` | GET | コスト分析データ |
| `/api/analytics/improvements` | GET | 改善提案データ |
| **エージェント** | | |
| `/api/agents` | GET/POST | エージェント一覧/作成 |
| `/api/agents/{id}` | GET/PUT/DELETE | エージェント詳細/更新/削除 |
| `/api/agents/{id}/test` | POST | エージェント単体テスト |
| `/api/agents/{id}/duplicate` | POST | エージェント複製 |
| **ツール** | | |
| `/api/tools` | GET/POST | ツール一覧/作成 |
| `/api/tools/{id}` | GET/PUT/DELETE | ツール詳細/更新/削除 |
| `/api/tools/{id}/test` | POST | ツール単体テスト |
| **パイプライン** | | |
| `/api/pipelines` | GET/POST | パイプライン一覧/作成 |
| `/api/pipelines/{id}` | GET/PUT/DELETE | パイプライン詳細/更新/削除 |
| `/api/pipelines/{id}/validate` | POST | パイプライン検証 |
| `/api/pipelines/{id}/run` | POST | パイプライン実行 |
| `/api/pipelines/{id}/duplicate` | POST | パイプライン複製 |
| **プロジェクト** | | |
| `/api/projects` | GET/POST | プロジェクト一覧/作成 |
| `/api/projects/{id}` | GET/PUT/DELETE | プロジェクト詳細/更新/削除 |
| `/api/projects/{id}/activate` | POST | プロジェクトをアクティブ化 |
| **実験** | | |
| `/api/experiments` | GET/POST | 実験一覧/作成 |
| `/api/experiments/{id}` | GET/PUT/DELETE | 実験詳細/更新/削除 |
| `/api/experiments/{id}/run` | POST | 実験実行 |
| `/api/experiments/{id}/compare` | GET | ベースラインとの比較 |
| `/api/experiments/{id}/snapshot` | POST | 設定スナップショット作成 |
| **シナリオグループ** | | |
| `/api/scenario-groups` | GET/POST | シナリオグループ一覧/作成 |
| `/api/scenario-groups/{id}` | GET/PUT/DELETE | シナリオグループ詳細/更新/削除 |
| **営業支援** | | |
| `/api/sales/proposals` | POST | 提案仮説生成 |
| `/api/sales/proposals/{id}/refine` | POST | 提案ブラッシュアップ |
| `/api/sales/proposals/{id}/export` | GET | 提案資料エクスポート |
| `/api/sales/customers` | GET/POST | 顧客一覧/登録 |
| `/api/sales/customers/{id}` | GET/PUT | 顧客詳細/更新 |

### 6.2 API詳細

#### 6.2.1 推論実行 API

```yaml
POST /api/inference/run
---
Request:
  content-type: application/json
  body:
    test_case_id: string | null          # テストケースID（カスタム入力時はnull）
    custom_input:                        # カスタム入力（test_case_idがnullの場合）
      company_info: object
      hearing_info: string
    prompt_versions:                     # 使用するプロンプトバージョン（省略時はlatest）
      needs_system: string | null
      needs_user: string | null
      solution_system: string | null
      solution_user: string | null
    knowledge_ids: string[]              # 使用するナレッジID
    options:
      run_evaluation: boolean            # 自動評価を実行するか（デフォルト: true）
      save_intermediate: boolean         # 中間結果を保存するか（デフォルト: true）

Response:
  id: string                             # 実行ID
  status: "success" | "failed" | "pending"
  output:
    needs_estimation:
      needs: Need[]
      summary: string
    solution_recommendation:
      strategy: string
      products: Product[]
      cautions: string[]
  intermediate_results:
    needs_estimation:
      raw_output: string
      parsed: object
      timestamp: string
    solution_recommendation:
      raw_output: string
      parsed: object
      timestamp: string
  auto_evaluation:
    hallucination_check: { passed: boolean, details: string }
    logic_check: { passed: boolean, details: string }
    rubric_scores:
      needs_coverage: { score: number, rating: string, comment: string }
      evidence_quality: { score: number, rating: string, comment: string }
      # ...
    overall_rating: string
  cost_info:
    total_cost_yen: number
    breakdown: object
  latency_info:
    total_seconds: number
    breakdown: object
  trace_id: string
```

#### 6.2.2 結果エクスポート API

```yaml
POST /api/results/export
---
Request:
  content-type: application/json
  body:
    result_ids: string[]                 # エクスポート対象ID（省略時は全件）
    filters:
      date_from: string
      date_to: string
      rating: string[]                   # ["◯", "△", "×"]
      status: string[]
    format: "csv" | "json" | "excel"
    include:
      input: boolean
      output: boolean
      intermediate: boolean
      evaluation: boolean
      cost: boolean

Response:
  content-type: application/octet-stream
  content-disposition: attachment; filename="results_20250122.csv"
```

#### 6.2.3 プロンプトバージョン作成 API

```yaml
POST /api/prompts/{prompt_id}/versions
---
Request:
  content-type: application/json
  body:
    content: string                      # プロンプト本文
    tag: string | null                   # タグ（"latest"は自動付与）
    comment: string                      # 変更コメント

Response:
  id: string
  prompt_id: string
  version: string                        # 自動採番（v1.0, v1.1...）
  content: string
  tag: string
  diff_from_previous: string             # 差分（unified diff形式）
  created_at: string
  created_by: string
```

#### 6.2.4 エージェント管理 API

```yaml
GET /api/agents
---
Query Parameters:
  type: string                           # フィルタ: inference/evaluation/improvement
  status: string                         # フィルタ: active/inactive/experimental

Response:
  agents:
    - id: string
      name: string
      description: string
      type: string
      status: string
      model_config:
        model: string
        temperature: number
      tool_count: number
      created_at: string
      updated_at: string

---
POST /api/agents
---
Request:
  content-type: application/json
  body:
    name: string                         # エージェント名（一意）
    description: string
    type: string                         # inference/evaluation/improvement
    system_prompt:                       # システムプロンプト設定
      prompt_id: string | null           # 既存プロンプト参照
      inline_content: string | null      # インライン定義（新規作成）
    user_prompt:                         # ユーザープロンプト設定
      prompt_id: string | null
      inline_content: string | null
    model_config:
      model: string                      # gpt-5.2, gpt-4-turbo等
      temperature: number
      max_tokens: number
      top_p: number
    output_schema: object                # JSON Schema
    tool_ids: string[]                   # 使用ツールID

Response:
  id: string
  name: string
  # ... 作成されたエージェント情報

---
POST /api/agents/{id}/test
---
Request:
  content-type: application/json
  body:
    test_input: object                   # テスト入力データ
    use_mock_tools: boolean              # ツールをモック化するか

Response:
  success: boolean
  output: object                         # エージェント出力
  raw_llm_response: string               # LLM生の応答
  cost_info:
    input_tokens: number
    output_tokens: number
    cost_yen: number
  latency_seconds: number
  trace_id: string
```

#### 6.2.5 ツール管理 API

```yaml
GET /api/tools
---
Query Parameters:
  type: string                           # search/validation/data_fetch
  status: string                         # active/inactive

Response:
  tools:
    - id: string
      name: string
      description: string
      type: string
      status: string
      created_at: string

---
POST /api/tools
---
Request:
  content-type: application/json
  body:
    name: string                         # ツール名（一意）
    description: string
    type: string                         # search/validation/data_fetch
    config: object                       # ツール固有設定
    input_schema: object                 # 入力JSON Schema
    output_schema: object                # 出力JSON Schema

Response:
  id: string
  name: string
  # ... 作成されたツール情報

---
POST /api/tools/{id}/test
---
Request:
  content-type: application/json
  body:
    test_input: object                   # テスト入力（input_schemaに準拠）

Response:
  success: boolean
  output: object                         # ツール出力（output_schemaに準拠）
  execution_time_ms: number
  error: string | null
```

#### 6.2.6 パイプライン管理 API

```yaml
GET /api/pipelines
---
Query Parameters:
  project_id: string                     # プロジェクトでフィルタ

Response:
  pipelines:
    - id: string
      name: string
      description: string
      is_default: boolean
      node_count: number
      project_id: string
      updated_at: string

---
POST /api/pipelines
---
Request:
  content-type: application/json
  body:
    name: string
    description: string
    project_id: string
    nodes:
      - id: string
        type: "agent" | "tool" | "input" | "output"
        ref_id: string                   # agent_id or tool_id
        position: { x: number, y: number }
        config: object                   # ノード固有設定
    edges:
      - source: string                   # ノードID
        target: string                   # ノードID
        mapping: object                  # データマッピング

Response:
  id: string
  name: string
  # ... 作成されたパイプライン情報

---
POST /api/pipelines/{id}/validate
---
Response:
  valid: boolean
  errors:
    - node_id: string
      message: string
  warnings:
    - node_id: string
      message: string

---
POST /api/pipelines/{id}/run
---
Request:
  content-type: application/json
  body:
    input_data: object                   # パイプライン入力
    save_intermediate: boolean           # 中間結果を保存

Response:
  execution_id: string
  status: "success" | "failed" | "partial"
  output: object                         # 最終出力
  intermediate_results:
    - node_id: string
      node_name: string
      output: object
      latency_ms: number
      cost_yen: number
  total_cost_yen: number
  total_latency_seconds: number
  trace_id: string
```

#### 6.2.7 プロジェクト・実験管理 API

```yaml
GET /api/projects
---
Response:
  projects:
    - id: string
      name: string
      description: string
      is_active: boolean
      experiment_count: number
      created_at: string

---
POST /api/projects
---
Request:
  content-type: application/json
  body:
    name: string
    description: string

Response:
  id: string
  name: string
  is_active: boolean                     # 新規作成時はtrueで自動アクティブ化
  created_at: string

---
POST /api/projects/{id}/activate
---
Response:
  success: boolean
  previous_active_project_id: string | null

---
GET /api/experiments
---
Query Parameters:
  project_id: string
  status: string                         # planned/running/completed

Response:
  experiments:
    - id: string
      name: string
      hypothesis: string
      status: string
      baseline_experiment_id: string | null
      scenario_group_name: string
      results_summary:
        layer1_pass_rate: number | null
        key_metric_diff: number | null
      created_at: string
      completed_at: string | null

---
POST /api/experiments
---
Request:
  content-type: application/json
  body:
    project_id: string
    name: string
    hypothesis: string                   # 仮説（例: "Few-shot追加で精度+5%"）
    baseline_experiment_id: string | null # 比較対象の実験
    scenario_group_id: string            # 使用するシナリオグループ
    config_overrides:                    # 実験用の設定オーバーライド
      prompt_versions: object | null
      agent_configs: object | null
      tool_configs: object | null
      pipeline_id: string | null

Response:
  id: string
  name: string
  snapshot:                              # 自動作成された設定スナップショット
    prompt_versions: object
    agent_configs: object
    tool_configs: object
    pipeline_id: string
  status: "planned"
  created_at: string

---
POST /api/experiments/{id}/run
---
Request:
  content-type: application/json
  body:
    max_parallel: number                 # 並列実行数（デフォルト: 5）

Response:
  execution_id: string
  status: "running"
  scenario_count: number
  estimated_cost_yen: number
  estimated_time_seconds: number

---
GET /api/experiments/{id}/compare
---
Response:
  experiment:
    id: string
    name: string
    hypothesis: string
  baseline:
    id: string
    name: string
  metrics_comparison:
    - metric_name: string
      experiment_value: number
      baseline_value: number
      diff: number
      diff_percent: number
      status: "improved" | "degraded" | "unchanged"
  conclusion_suggestion: string          # AI生成の結論提案
  statistical_significance: object | null # 統計的有意性（サンプル数が十分な場合）
```

#### 6.2.8 シナリオグループ管理 API

```yaml
GET /api/scenario-groups
---
Query Parameters:
  project_id: string

Response:
  scenario_groups:
    - id: string
      name: string
      description: string
      test_case_count: number
      created_at: string

---
POST /api/scenario-groups
---
Request:
  content-type: application/json
  body:
    project_id: string
    name: string
    description: string
    test_case_ids: string[]              # 含めるテストケースID
    filters:                             # または動的フィルタで定義
      difficulty: string[]
      tags: string[]
      industry: string[]

Response:
  id: string
  name: string
  test_case_count: number
  test_cases:                            # 含まれるテストケース一覧
    - id: string
      name: string
      difficulty: string
```

#### 6.2.9 営業支援 API

```yaml
POST /api/sales/proposals
---
Description: 顧客情報から提案仮説を生成
Request:
  content-type: application/json
  body:
    customer_id: string | null           # 登録済み顧客ID
    customer_info:                       # または顧客情報を直接指定
      company_name: string
      industry: string
      revenue: number
      employee_count: number
      president_age: number
      # ... その他の企業情報
    hearing_info: string                 # 面談記録・ヒアリング情報
    additional_context: string | null    # 追加コンテキスト（競合状況等）

Response:
  proposal_id: string
  needs_estimation:
    needs:
      - name: string
        priority: "high" | "medium" | "low"
        confidence: "high" | "medium" | "low"
        evidence: string
        similar_cases: string[]
    additional_questions:                # 追加ヒアリング推奨項目
      - question: string
        reason: string
  solution_recommendation:
    strategy: string                     # 提案方針
    reasoning: string                    # 理由
    cautions: string[]                   # 注意点
    recommended_products:
      - name: string
        target_need: string
        key_points: string
        similar_success_case: string | null
  similar_cases:                         # 類似企業の過去事例
    - company_profile: string
      needs: string[]
      proposal: string
      result: "success" | "failed"
      lessons: string
  cost_info:
    total_cost_yen: number
  trace_id: string

---
POST /api/sales/proposals/{id}/refine
---
Description: 提案をブラッシュアップ
Request:
  content-type: application/json
  body:
    feedback: string                     # ユーザーからのフィードバック
    # 例: "与信上限があるので融資は除外して"
    #     "もっと事業承継を深掘りして"
    #     "M&Aの可能性も含めて考えて"

Response:
  proposal_id: string
  version: number                        # ブラッシュアップ回数
  changes_summary: string                # 変更点サマリ
  needs_estimation:                      # 更新後のニーズ推定
    # ... 同上
  solution_recommendation:               # 更新後の提案方針
    # ... 同上
  feedback_category: string              # フィードバックの分類
  # "constraint_added" | "priority_change" | "topic_expansion" | "product_change" | "tone_change"

---
GET /api/sales/proposals/{id}/export
---
Query Parameters:
  format: "pdf" | "pptx" | "markdown"

Response:
  content-type: application/octet-stream
  content-disposition: attachment; filename="proposal_xxx.pdf"

---
GET /api/sales/customers
---
Query Parameters:
  search: string                         # 企業名で検索
  industry: string                       # 業種でフィルタ

Response:
  customers:
    - id: string
      company_name: string
      industry: string
      revenue: number
      last_contact_date: string
      proposal_count: number

---
POST /api/sales/customers
---
Request:
  content-type: application/json
  body:
    company_name: string
    industry: string
    revenue: number
    employee_count: number
    president_name: string
    president_age: number
    established_year: number
    bank_relationship:
      loan_amount: number
      deposit_amount: number
      relationship_years: number
    notes: string

Response:
  id: string
  company_name: string
  # ... 登録された顧客情報
```

---

## 7. 非機能要件

### 7.1 パフォーマンス

| 項目 | 要件 |
|------|------|
| 単発推論 | 10秒以内（LLM呼び出し込み） |
| バッチ推論（100件） | 30分以内 |
| 画面表示 | 3秒以内 |
| エクスポート（100件） | 10秒以内 |

### 7.2 同時利用

| 項目 | 要件 |
|------|------|
| 同時アクセス | 5ユーザー程度 |
| バッチ実行 | 1件/時（同時実行なし） |

### 7.3 データ保持

| 項目 | 要件 |
|------|------|
| 実行結果 | 無期限（PoC期間中） |
| プロンプトバージョン | 全履歴保持 |
| ログ | 30日 |

### 7.4 セキュリティ（PoC）

| 項目 | 対応 |
|------|------|
| 認証 | 簡易認証（Basic認証 or 共有パスワード） |
| 通信 | HTTPS |
| データ暗号化 | なし（PoC） |

---

## 8. 開発計画

### 8.1 フェーズ分け

| フェーズ | 期間 | 内容 |
|----------|------|------|
| **Phase 1** | Week 1-2 | 基盤構築（API/DB/基本UI） |
| **Phase 2** | Week 3-4 | 推論実行・結果表示 |
| **Phase 3** | Week 5-6 | プロンプト管理・データ管理 |
| **Phase 4** | Week 7-8 | レビュー・分析・改善提案 |
| **Phase 5** | Week 9 | 統合テスト・改善 |

### 8.2 MVP（Phase 2完了時点）

```
MVP機能:
✅ 単発推論実行
✅ 結果一覧・詳細表示
✅ 中間結果確認
✅ 自動評価（Layer1）
✅ 基本的なプロンプト管理
✅ 結果ダウンロード（CSV）
```

---

## 9. 付録

### 9.1 技術選定の補足

#### Streamlit vs Gradio

| 観点 | Streamlit | Gradio |
|------|-----------|--------|
| カスタマイズ性 | 高い | 中程度 |
| 学習コスト | 低い | 低い |
| 複雑なレイアウト | 対応可 | 制限あり |
| デプロイ | 簡単 | 簡単 |

→ **Streamlit採用**: 複雑な画面レイアウトに対応可能

#### SQLite vs PostgreSQL

| 観点 | SQLite | PostgreSQL |
|------|--------|------------|
| セットアップ | 不要 | 必要 |
| 同時アクセス | 制限あり | 高い |
| JSON操作 | 基本的 | 高機能 |
| 本番移行 | 移行必要 | そのまま |

→ **SQLite採用（PoC）**: 開発速度優先、本番化時にPostgreSQLへ移行

### 9.2 ディレクトリ構成

```
mock_system/
├── app/
│   ├── api/
│   │   ├── __init__.py
│   │   ├── inference.py           # 推論実行API
│   │   ├── results.py             # 結果管理API
│   │   ├── prompts.py             # プロンプト管理API
│   │   ├── agents.py              # エージェント管理API
│   │   ├── tools.py               # ツール管理API
│   │   ├── pipelines.py           # パイプライン管理API
│   │   ├── projects.py            # プロジェクト管理API
│   │   ├── experiments.py         # 実験管理API
│   │   ├── scenario_groups.py     # シナリオグループAPI
│   │   ├── data.py                # データ管理API
│   │   ├── reviews.py             # レビュー管理API
│   │   ├── analytics.py           # 分析API
│   │   └── sales.py               # 営業支援API
│   ├── core/
│   │   ├── __init__.py
│   │   ├── llm_client.py          # Azure OpenAI クライアント
│   │   ├── tracer.py              # Opik トレーサー（抽象化レイヤー）
│   │   ├── evaluator.py           # 自動評価エンジン
│   │   ├── cost_tracker.py        # コスト追跡
│   │   └── snapshot.py            # 設定スナップショット管理
│   ├── services/
│   │   ├── __init__.py
│   │   ├── needs_estimator.py     # ニーズ推定エージェント
│   │   ├── solution_recommender.py # ソリューション推薦エージェント
│   │   ├── improvement_suggester.py # 改善提案生成
│   │   ├── pipeline_executor.py   # パイプライン実行エンジン
│   │   └── experiment_runner.py   # 実験実行管理
│   ├── tools/                     # ツール実装
│   │   ├── __init__.py
│   │   ├── base.py                # ツール基底クラス
│   │   ├── knowledge_retriever.py # ナレッジ検索ツール
│   │   ├── product_search.py      # 商材検索ツール
│   │   ├── data_enricher.py       # データ補完ツール
│   │   └── hallucination_check.py # ハルシネーション検証ツール
│   ├── models/
│   │   ├── __init__.py
│   │   ├── prompt.py              # プロンプト・バージョン
│   │   ├── agent.py               # エージェント定義
│   │   ├── tool.py                # ツール定義
│   │   ├── pipeline.py            # パイプライン定義
│   │   ├── project.py             # プロジェクト
│   │   ├── experiment.py          # 実験
│   │   ├── scenario_group.py      # シナリオグループ
│   │   ├── result.py              # 実行結果
│   │   ├── review.py              # レビュー
│   │   ├── data.py                # ナレッジ・商材・テストケース
│   │   └── customer.py            # 顧客（営業支援用）
│   ├── schemas/                   # Pydantic スキーマ
│   │   ├── __init__.py
│   │   ├── requests.py            # リクエストスキーマ
│   │   ├── responses.py           # レスポンススキーマ
│   │   └── json_schemas/          # JSON Schema定義
│   │       ├── needs_output.json
│   │       └── solution_output.json
│   ├── db/
│   │   ├── __init__.py
│   │   ├── database.py            # DB接続・セッション管理
│   │   ├── repositories/          # リポジトリパターン
│   │   │   ├── __init__.py
│   │   │   ├── prompt_repo.py
│   │   │   ├── agent_repo.py
│   │   │   ├── experiment_repo.py
│   │   │   └── ...
│   │   └── migrations/
│   └── main.py
├── frontend/
│   ├── pages/
│   │   ├── 01_🏠_Dashboard.py          # ダッシュボード
│   │   ├── 02_🤖_Inference.py          # 推論実行
│   │   ├── 03_📋_Results.py            # 結果一覧
│   │   ├── 04_📝_Prompts.py            # プロンプト管理
│   │   ├── 05_🔌_Agents.py             # エージェント管理
│   │   ├── 06_🔧_Tools.py              # ツール管理
│   │   ├── 07_🔀_Pipeline.py           # パイプライン設計
│   │   ├── 08_📁_Data.py               # データ管理
│   │   ├── 09_🧪_Projects.py           # プロジェクト・実験管理
│   │   ├── 10_📊_Review.py             # レビュー
│   │   ├── 11_💰_Cost.py               # コスト分析
│   │   ├── 12_🔧_Improvements.py       # 改善提案
│   │   └── 13_💼_Sales.py              # 営業支援UI
│   ├── components/
│   │   ├── __init__.py
│   │   ├── charts.py              # グラフコンポーネント
│   │   ├── tables.py              # テーブルコンポーネント
│   │   ├── forms.py               # フォームコンポーネント
│   │   ├── pipeline_editor.py     # パイプラインエディタ（ノード/エッジ）
│   │   ├── json_schema_editor.py  # JSON Schema編集UI
│   │   └── diff_viewer.py         # 差分表示コンポーネント
│   └── Home.py
├── data/
│   ├── prompts/                   # プロンプトYAMLファイル
│   │   ├── needs_system.yaml
│   │   ├── needs_user.yaml
│   │   ├── solution_system.yaml
│   │   └── solution_user.yaml
│   ├── agents/                    # エージェント定義YAML
│   │   ├── needs_estimator.yaml
│   │   ├── solution_recommender.yaml
│   │   └── auto_evaluator.yaml
│   ├── tools/                     # ツール設定YAML
│   │   ├── knowledge_retriever.yaml
│   │   └── product_search.yaml
│   ├── pipelines/                 # パイプライン定義JSON
│   │   └── default_pipeline.json
│   ├── knowledge/                 # ナレッジデータ
│   ├── products/                  # 商材マスタ
│   ├── testcases/                 # テストケース（100シナリオ）
│   └── customers/                 # 顧客データ（営業支援用サンプル）
├── tests/
│   ├── api/                       # APIテスト
│   ├── services/                  # サービステスト
│   ├── tools/                     # ツールテスト
│   └── e2e/                       # E2Eテスト
├── scripts/
│   ├── seed_data.py               # 初期データ投入
│   ├── migrate_db.py              # DBマイグレーション
│   └── export_results.py          # 結果一括エクスポート
├── requirements.txt
├── docker-compose.yml
├── Dockerfile
├── .env.example
└── README.md
```

---

> **次のステップ**: Phase 1 基盤構築へ
