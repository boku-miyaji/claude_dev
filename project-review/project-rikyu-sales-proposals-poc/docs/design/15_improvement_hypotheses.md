# 改善仮説・課題仮説

> **関連**: [設計書サマリ](00_summary.md) | [技術設計](06_technical_design.md) | [ナレッジ設計](14_knowledge_design.md)

---

## 目的

本ドキュメントは、PoC初期版からの改善仮説・課題仮説を追跡・整理する。
検証を進める中で発見した課題と、それに対する対応策の仮説を記録し、
段階的なアップデートの方向性を明確にする。

---

## 1. 6AIアーキテクチャ（3層構造）

### 1.1 アーキテクチャ概要

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           6AIアーキテクチャ（3層構造）                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【生成レイヤー】                                                                │
│  ┌─────────────────────┐         ┌─────────────────────┐                       │
│  │ AI① ニーズ推定AI    │────────▶│ AI② 提案方針策定AI  │                       │
│  │ ※根拠必須           │         │ ※根拠必須           │                       │
│  │ ※経営アジェンダ起点 │         │ ※商品起点ではない   │                       │
│  └──────────┬──────────┘         └──────────┬──────────┘                       │
│             │                               │                                   │
│             ▼                               ▼                                   │
│  【評価レイヤー】                                                                │
│  ┌─────────────────────┐         ┌─────────────────────┐                       │
│  │ AI③ ニーズ推定評価AI│         │ AI④ 提案方針評価AI  │                       │
│  │ ※根拠必須           │         │ ※根拠必須           │                       │
│  │ ※解像度はルーブリック│         │ ※解像度・充足度は   │                       │
│  │   の一つ            │         │   ルーブリックの一つ │                       │
│  └──────────┬──────────┘         └──────────┬──────────┘                       │
│             │                               │                                   │
│             ▼ (評価が△×の場合)              ▼ (評価が△×の場合)                  │
│  【改善レイヤー】                                                                │
│  ┌─────────────────────┐         ┌─────────────────────┐                       │
│  │ AI⑤ ニーズ推定      │         │ AI⑥ 提案方針        │                       │
│  │   課題特定・改善策AI │         │   課題特定・改善策AI │                       │
│  └─────────────────────┘         └─────────────────────┘                       │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 フェーズ別実装計画

| Phase | 時期 | 実装範囲 | AI⑤⑥ |
|-------|------|----------|-------|
| **Phase 1** | W2-3 | AI①②③④（基本版） | 未実装（人が改善策検討） |
| **Phase 2** | W4-6 | AI⑤⑥導入、解像度ルーブリック細分化 | 実装（評価が△×で発動） |
| **Phase 3** | W7-9 | 改善策の自動適用、過去事例活用 | 最適化 |

### 1.3 Phase 1（シンプル版）の制約・前提

| 項目 | Phase 1での対応 |
|------|---------------|
| 過去事例の検索 | なし（データ蓄積後に対応） |
| 類似度計算 | なし |
| ナレッジの活用 | プロンプト内にハードコード |
| 課題特定・改善策 | 人が実施（AI⑤⑥は未実装） |
| 解像度評価 | 評価AIのルーブリックの一つとして実装 |

---

## 2. 課題仮説

### 2.1 過去事例活用の課題

| ID | 課題仮説 | 想定される影響 | 検証方法 |
|----|---------|---------------|---------|
| CH-001 | **過去事例がないと提案の具体性・説得力が不足する** | 提案が抽象的になる、営業の納得感が薄い | シナリオ検証で事例有無の影響を評価 |
| CH-002 | **類似企業の定義が曖昧** | 「類似」の判断がブレる、再現性がない | 営業担当者に類似企業の定義をヒアリング |
| CH-003 | **過去事例の検索が手動依存** | スケール不可、属人化のリスク | 事例検索の工数を計測 |

### 2.2 ナレッジ活用の課題

| ID | 課題仮説 | 想定される影響 | 検証方法 |
|----|---------|---------------|---------|
| CH-004 | **暗黙知のプロンプト投入方法が最適化されていない** | ナレッジを入れても出力精度が上がらない | A/Bテストで効果を測定 |
| CH-005 | **ナレッジの更新・メンテナンスが煩雑** | 古いナレッジが残り精度低下 | 運用フローの検証 |

### 2.3 出力品質の課題

| ID | 課題仮説 | 想定される影響 | 検証方法 |
|----|---------|---------------|---------|
| CH-006 | **提案方針が抽象的すぎる** | 営業が具体的なアクションに落とせない | ユーザーFBで評価 |
| CH-007 | **ネクストアクションが汎用的** | 実際の顧客状況に合わない | シナリオ検証で評価 |

### 2.4 6AIアーキテクチャ Phase 1 課題仮説

> **注**: 6AIアーキテクチャのPhase 1（シンプル版）で想定される課題

| ID | 課題仮説 | 想定される影響 | 検証方法 |
|----|---------|---------------|---------|
| P1-001 | **生成AIの「根拠」が後付けで実際の推論過程と異なる** | 根拠を見ても改善に役立たない | 人が根拠を検証し妥当性評価 |
| P1-002 | **評価AIの評価理由が抽象的すぎる** | 具体的な改善アクションが取れない | 評価理由の具体性をルーブリック化 |
| P1-003 | **解像度を1ルーブリックにすると粒度が粗い** | 問題/状況、ゴール/制約の区別ができない | Phase 2で細分化して比較検証 |
| P1-004 | **課題特定・改善策を人が行うのは工数がかかる** | 改善サイクルが遅くなる | AI⑤⑥導入の効果検証 |
| P1-005 | **提案方針がアジェンダ起点になっているか判定が難しい** | 商品起点に戻りやすい | ルーブリック「strategy_coherence」の精緻化 |
| P1-006 | **評価AIの評価が人と一致しない** | 自動評価の信頼性が低い | W3-6で人評価との一致率を継続検証 |

### 2.5 Phase 2以降で想定される課題

| ID | 課題仮説 | Phase | 対応方針 |
|----|---------|-------|---------|
| P2-001 | AI⑤⑥の改善策が抽象的 | Phase 2 | プロンプト改善、具体例追加 |
| P2-002 | 改善策の自動適用が困難 | Phase 3 | 人が適用判断、段階的自動化 |
| P2-003 | 評価と改善のループが遅い | Phase 3 | バッチ処理からリアルタイム化 |

---

## 3. 改善仮説（対応策）

### 3.1 類似度ベースの事例検索（★優先度：高）

> **課題**: CH-001, CH-002, CH-003 に対応

#### 改善の方向性

```
┌─────────────────────────────────────────────────────────────────────┐
│              類似度ベースの過去事例検索（改善案）                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  【現状】初期版は過去事例なし                                        │
│  ├─ データ蓄積後に対応予定                                          │
│  └─ 改善版で類似度ベースの動的検索を実装                            │
│                                                                     │
│  【改善案】類似度ベース検索                                          │
│  ├─ 企業情報をベクトル化 → 類似企業を自動検索                       │
│  ├─ 推定ニーズをベクトル化 → 類似ニーズの事例を検索                 │
│  └─ 検索結果をプロンプトに動的投入                                  │
│                                                                     │
│  【類似度の軸】                                                      │
│  ├─ 企業の類似度: 業種 × 規模 × 財務状況 × 地域 × 経営課題         │
│  ├─ ニーズの類似度: 推定ニーズカテゴリ × 優先度 × 背景             │
│  └─ 状況の類似度: キーパーソン構成 × 関係性 × 提案ステージ         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 実装イメージ

```python
# === 類似事例検索の改善イメージ ===

class SimilarCaseSearcher:
    """類似度ベースの事例検索"""

    def __init__(self, embedding_client, vector_db):
        self.embedding = embedding_client  # text-embedding-3-large
        self.db = vector_db  # Azure AI Search

    def search_by_company_similarity(
        self,
        target_company: CompanyInfo,
        top_k: int = 5
    ) -> list[PastCase]:
        """企業の類似度で過去事例を検索"""
        # 企業情報をテキスト化してEmbedding
        company_text = self._format_company_for_embedding(target_company)
        embedding = self.embedding.embed(company_text)

        # ベクトル検索
        results = self.db.search(
            vector=embedding,
            filter={"case_type": "提案事例"},
            top_k=top_k
        )
        return results

    def search_by_needs_similarity(
        self,
        estimated_needs: list[EstimatedNeed],
        top_k: int = 5
    ) -> list[PastCase]:
        """推定ニーズの類似度で過去事例を検索"""
        # ニーズリストをテキスト化してEmbedding
        needs_text = self._format_needs_for_embedding(estimated_needs)
        embedding = self.embedding.embed(needs_text)

        # ベクトル検索
        results = self.db.search(
            vector=embedding,
            filter={"case_type": "ニーズ対応事例"},
            top_k=top_k
        )
        return results

    def _format_company_for_embedding(self, company: CompanyInfo) -> str:
        """企業情報をEmbedding用テキストに変換"""
        return f"""
        業種: {company.industry}
        規模: {company.revenue}億円
        従業員: {company.employees}名
        主な経営課題: {', '.join(company.key_issues)}
        財務特徴: {company.financial_summary}
        """
```

#### 期待効果

| 指標 | 現状 | 期待改善 |
|------|------|----------|
| 事例の関連性 | 低（固定事例のため） | 高（動的に最適事例を選定） |
| 提案の説得力 | 「他社でも同様」程度 | 「御社と同業種・同規模の○○社では」 |
| 営業の納得感 | 抽象的な参考情報 | 具体的で参考になる事例 |

#### 導入検討時期

- **PoC v0.2**（中盤）: Embedding + Azure AI Search の基盤構築
- **PoC v0.3**（後半）: 企業類似度検索の本格導入
- **本番化時**: ニーズ類似度・状況類似度の追加

---

### 3.2 ナレッジの動的適用（★優先度：中）

> **課題**: CH-004, CH-005 に対応

#### 改善の方向性

```
┌─────────────────────────────────────────────────────────────────────┐
│                 ナレッジの動的適用（改善案）                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  【現状】ハードコード                                                │
│  └─ プロンプトに固定でナレッジを埋め込み                            │
│                                                                     │
│  【改善案】動的選択                                                  │
│  ├─ 状況に応じて適用するナレッジを選択                              │
│  ├─ ナレッジの効果を測定し、重み付けを調整                          │
│  └─ ナレッジの追加・更新を容易に                                    │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 3.3 出力の具体化（★優先度：中）

> **課題**: CH-006, CH-007 に対応

#### 改善の方向性

- ネクストアクションに具体的な日時・担当者を含める
- 提案方針にステップバイステップのアクションプランを追加
- キーパーソンごとのアプローチ方法を詳細化

---

## 4. 改善ロードマップ

### 4.1 6AIアーキテクチャ フェーズ別ロードマップ

```
┌─────────────────────────────────────────────────────────────────────┐
│                   6AIアーキテクチャ ロードマップ                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  【Phase 1】シンプル版（W2-3）                                       │
│  ├─ AI①②: 基本実装（根拠出力を必須化）                             │
│  ├─ AI③④: 基本実装（評価理由=根拠必須、解像度はルーブリック）      │
│  ├─ AI⑤⑥: 未実装（人が課題特定・改善策を検討）                     │
│  └─ 目標: 動作確認、初回FB収集                                      │
│                                                                     │
│  【Phase 2】改善AI導入版（W4-6）                                     │
│  ├─ AI⑤⑥: 課題特定・改善策AIを実装                                 │
│  ├─ 解像度ルーブリックを細分化（問題/状況、ゴール/制約）            │
│  ├─ 評価精度の検証（人評価との比較）                                │
│  └─ 目標: 評価→改善サイクルの自動化                                 │
│                                                                     │
│  【Phase 3】最適化版（W7-9）                                         │
│  ├─ 改善策の自動適用検討（プロンプト修正等）                        │
│  ├─ 過去事例・ナレッジの動的活用                                    │
│  ├─ パターン分析・傾向把握                                          │
│  └─ 目標: 継続的改善の仕組み確立                                    │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.2 機能拡張ロードマップ

```
┌─────────────────────────────────────────────────────────────────────┐
│                      機能拡張ロードマップ                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  【Phase 1】シンプル版                                               │
│  ├─ 過去事例なし（データ蓄積後に対応）                              │
│  ├─ ハードコードされたナレッジ                                      │
│  └─ 基本的なニーズ推定・提案方針策定                                │
│                                                                     │
│  【Phase 2-3】類似度検索導入                                         │
│  ├─ Embedding基盤の構築                                             │
│  ├─ 企業類似度による事例検索                                        │
│  └─ 検索精度の検証・チューニング                                    │
│                                                                     │
│  【将来】本番化後                                                    │
│  ├─ ニーズ類似度による事例検索                                      │
│  ├─ ナレッジの動的適用・自動更新                                    │
│  └─ 成約予測の高度化                                                │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 5. 検証結果の記録

### 5.1 課題仮説の検証状況

| ID | 課題仮説 | 検証状況 | 結果 | 備考 |
|----|---------|---------|------|------|
| CH-001 | 過去事例不足の影響 | 未検証 | - | データ蓄積後に検証予定 |
| CH-002 | 類似企業定義の曖昧さ | 未検証 | - | - |
| CH-003 | 事例検索の手動依存 | 未検証 | - | - |
| CH-004 | ナレッジ投入方法 | 未検証 | - | - |
| CH-005 | ナレッジメンテナンス | 未検証 | - | - |
| CH-006 | 提案の抽象性 | 未検証 | - | - |
| CH-007 | NAの汎用性 | 未検証 | - | - |

### 5.2 Phase 1 課題仮説の検証状況

| ID | 課題仮説 | 検証状況 | 結果 | 備考 |
|----|---------|---------|------|------|
| P1-001 | 根拠の後付け問題 | 未検証 | - | W3で初回検証予定 |
| P1-002 | 評価理由の抽象性 | 未検証 | - | W3で初回検証予定 |
| P1-003 | 解像度の粒度問題 | 未検証 | - | Phase 2で細分化検討 |
| P1-004 | 改善策の人依存 | 未検証 | - | Phase 2でAI⑤⑥導入 |
| P1-005 | アジェンダ起点の判定困難 | 未検証 | - | W3で初回検証予定 |
| P1-006 | 評価AIと人の不一致 | 未検証 | - | W3-6で継続検証 |

### 5.3 改善仮説の検証状況

| 改善案 | 検証状況 | 結果 | 採用判断 |
|--------|---------|------|----------|
| 6AIアーキテクチャ | 設計完了 | - | 採用（Phase 1から実装） |
| 解像度ルーブリック | 設計完了 | - | 採用（評価AIに組み込み） |
| 課題特定・改善策AI | 設計完了 | - | Phase 2で実装予定 |
| 類似度ベース事例検索 | 未検証 | - | Phase 2-3で検討 |

---

## 更新履歴

| 日付 | バージョン | 更新内容 | 担当 |
|------|-----------|---------|------|
| 2026-01-26 | 1.1 | 6AIアーキテクチャ対応、Phase 1課題仮説追加 | - |
| 2026-01-26 | 1.0 | 初版作成 | - |
