# rikyu PoC検証システム UX/UI設計書

> **作成日**: 2026-01-23
> **バージョン**: v1.0
> **参考**: base_framework設計パターン, 09_mock_system_design.md

---

## 1. UX設計

### 1.1 ユーザーペルソナ

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          ペルソナ定義                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  👨‍💼 Persona A: PoC開発者（主要ユーザー）                              │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │  名前: 田中エンジニア                                                │   │
│  │  役割: AIエンジニア / MLエンジニア                                   │   │
│  │  目的: プロンプト改善サイクルを高速に回す                            │   │
│  │                                                                     │   │
│  │  【主要タスク】                                                      │   │
│  │  ・プロンプトの編集・テスト実行                                      │   │
│  │  ・Mock/Real LLMの切り替え検証                                       │   │
│  │  ・評価結果の確認・分析                                              │   │
│  │  ・コスト・パフォーマンスの監視                                      │   │
│  │                                                                     │   │
│  │  【ペインポイント】                                                  │   │
│  │  ・コードを触らずにプロンプトを試したい                              │   │
│  │  ・APIコストを気にせず高速に試行錯誤したい                           │   │
│  │  ・変更の効果を定量的に把握したい                                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  👩‍💼 Persona B: ドメインエキスパート（評価者）                          │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │  名前: 鈴木マネージャー                                              │   │
│  │  役割: 営業部門マネージャー / 業務知見者                             │   │
│  │  目的: AI出力の品質を業務視点で評価                                  │   │
│  │                                                                     │   │
│  │  【主要タスク】                                                      │   │
│  │  ・AI出力の人手評価（◯△×判定）                                      │   │
│  │  ・改善フィードバックの入力                                          │   │
│  │  ・ナレッジ・商材データの確認・編集                                  │   │
│  │                                                                     │   │
│  │  【ペインポイント】                                                  │   │
│  │  ・技術的な操作なく評価したい                                        │   │
│  │  ・入力と出力を並べて比較したい                                      │   │
│  │  ・評価基準を統一したい                                              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  👨‍💻 Persona C: プロジェクトマネージャー                                │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │  名前: 山田PM                                                        │   │
│  │  役割: PoCプロジェクト管理者                                         │   │
│  │  目的: 検証進捗とKPIの把握                                           │   │
│  │                                                                     │   │
│  │  【主要タスク】                                                      │   │
│  │  ・全体の検証進捗確認                                                │   │
│  │  ・KPI（精度、コスト）の推移把握                                     │   │
│  │  ・レポート出力・報告資料作成                                        │   │
│  │                                                                     │   │
│  │  【ペインポイント】                                                  │   │
│  │  ・一目で全体状況を把握したい                                        │   │
│  │  ・報告用データを簡単に出力したい                                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 ユーザージャーニーマップ

#### 1.2.1 開発者ジャーニー（日常の改善サイクル）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                    開発者ジャーニー: プロンプト改善サイクル                                  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  Phase 1: 課題発見        Phase 2: 仮説立案       Phase 3: 検証        Phase 4: 効果測定  │
│  ─────────────────       ─────────────────       ─────────────────    ─────────────────  │
│                                                                                         │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐   ┌─────────────────┐│
│  │ ダッシュボード   │───▶│ 結果詳細        │───▶│ プロンプト編集   │──▶│ コスト分析     ││
│  │ で低評価確認    │    │ で原因特定      │    │ で改善を適用     │   │ で効果確認     ││
│  └─────────────────┘    └─────────────────┘    └─────────────────┘   └─────────────────┘│
│         │                      │                      │                     │           │
│         ▼                      ▼                      ▼                     ▼           │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐   ┌─────────────────┐│
│  │「ハルシ率が      │    │「商材マスタに    │    │「商材は必ず      │   │「ハルシ率が     ││
│  │ 5%に上昇」      │    │ ない商品名を     │    │ マスタから       │   │  2%に低下！」  ││
│  │                 │    │  生成している」   │    │ 選択」と追記    │   │                ││
│  └─────────────────┘    └─────────────────┘    └─────────────────┘   └─────────────────┘│
│                                                                                         │
│  【使用画面】                                                                            │
│  Dashboard → Results → Results Detail → Prompts → Execution → Cost Analysis            │
│                                                                                         │
│  【感情曲線】                                                                            │
│   😟 課題発見     🤔 原因分析      💡 改善案浮上     😊 効果確認                         │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

#### 1.2.2 評価者ジャーニー（人手評価フロー）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                    評価者ジャーニー: 人手評価フロー                                         │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  Phase 1: 確認           Phase 2: 評価           Phase 3: FB入力     Phase 4: 完了      │
│  ─────────────────       ─────────────────       ─────────────────   ─────────────────  │
│                                                                                         │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐  ┌─────────────────┐│
│  │ レビュー画面で   │───▶│ 入力と出力を    │───▶│ ◯△×と         │─▶│ 次の件へ        ││
│  │ 未評価案件確認   │    │ 並べて確認      │    │ コメント入力    │  │ または終了      ││
│  └─────────────────┘    └─────────────────┘    └─────────────────┘  └─────────────────┘│
│         │                      │                      │                    │           │
│         ▼                      ▼                      ▼                    ▼           │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐  ┌─────────────────┐│
│  │「本日15件の      │    │「このニーズは    │    │「根拠の妥当性    │  │「15件完了、     ││
│  │ 評価依頼あり」   │    │  正しいか？」    │    │ が弱い」と入力   │  │  お疲れ様！」   ││
│  └─────────────────┘    └─────────────────┘    └─────────────────┘  └─────────────────┘│
│                                                                                         │
│  【使用画面】                                                                            │
│  Review (一覧) → Review (詳細+入力) → Review (確認) → Dashboard                         │
│                                                                                         │
│  【重要UXポイント】                                                                      │
│  ・入力と出力の並列表示                                                                  │
│  ・キーボードショートカット対応（1:◯ 2:△ 3:× Enter:次へ）                              │
│  ・進捗バーで残り件数表示                                                                │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 ユースケース別画面フロー

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         主要ユースケース別 画面フロー                                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  【UC-1】単発推論実行                                                                    │
│  Dashboard ──▶ Execution ──▶ Results Detail                                            │
│                   │                                                                     │
│                   └──▶ (エラー時) Error Detail                                          │
│                                                                                         │
│  【UC-2】バッチ推論実行                                                                  │
│  Dashboard ──▶ Execution (Batch Tab) ──▶ Results List ──▶ Results Detail               │
│                                                                                         │
│  【UC-3】プロンプト改善                                                                  │
│  Dashboard ──▶ Prompts List ──▶ Prompt Detail ──▶ Prompt Editor                        │
│                                          │              │                               │
│                                          ▼              │                               │
│                                    Version History ◀────┘                               │
│                                                                                         │
│  【UC-4】人手評価                                                                        │
│  Dashboard ──▶ Review (Filter: 未評価) ──▶ Review Detail ──▶ (次の件)                  │
│                                                    │                                    │
│                                                    └──▶ Dashboard (完了)                │
│                                                                                         │
│  【UC-5】コスト・効果分析                                                                │
│  Dashboard ──▶ Cost Analysis ──▶ Version Comparison                                    │
│                                                                                         │
│  【UC-6】データ管理                                                                      │
│  Dashboard ──▶ Data Management ──▶ Knowledge/Products/Cases                            │
│                                           │                                             │
│                                           └──▶ Import/Export                            │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 情報アーキテクチャ

### 2.1 画面構成（サイトマップ）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              画面構成（IA）                                               │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  🏠 Dashboard (/）                                                                      │
│  │                                                                                      │
│  ├── 🤖 推論実行 (/execution)                                                           │
│  │       ├── 単発実行 Tab                                                               │
│  │       ├── バッチ実行 Tab                                                             │
│  │       └── 対話ブラッシュアップ Tab                                                    │
│  │                                                                                      │
│  ├── 📊 結果管理 (/results)                                                             │
│  │       ├── 結果一覧                                                                   │
│  │       └── 結果詳細 (/results/{id})                                                   │
│  │               ├── 入力情報                                                           │
│  │               ├── プロセス別出力                                                      │
│  │               ├── 評価結果                                                           │
│  │               └── メトリクス                                                          │
│  │                                                                                      │
│  ├── 📝 プロンプト管理 (/prompts)                                                        │
│  │       ├── プロンプト一覧                                                             │
│  │       └── プロンプト詳細 (/prompts/{id})                                              │
│  │               ├── バージョン履歴                                                      │
│  │               ├── 差分表示                                                           │
│  │               └── 編集画面                                                           │
│  │                                                                                      │
│  ├── 📋 レビュー (/review)                                                               │
│  │       ├── 評価対象一覧                                                               │
│  │       └── 評価入力画面                                                               │
│  │                                                                                      │
│  ├── 📁 データ管理 (/data)                                                               │
│  │       ├── ナレッジ Tab                                                               │
│  │       ├── 商材マスタ Tab                                                             │
│  │       ├── テストケース Tab                                                           │
│  │       └── インポート/エクスポート                                                     │
│  │                                                                                      │
│  ├── 💰 コスト分析 (/cost)                                                               │
│  │       ├── サマリー                                                                   │
│  │       ├── プロセス別内訳                                                             │
│  │       ├── 推移グラフ                                                                 │
│  │       └── バージョン比較                                                             │
│  │                                                                                      │
│  ├── 🔧 改善提案 (/improvements)                                                         │
│  │       ├── 低評価分析                                                                 │
│  │       ├── 自動改善提案                                                               │
│  │       └── 改善履歴                                                                   │
│  │                                                                                      │
│  └── ⚙️ 設定 (/settings)                                                                │
│          ├── LLMプロバイダー設定                                                         │
│          ├── Tracer設定                                                                 │
│          └── プロジェクト設定                                                            │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 ナビゲーション設計

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           ナビゲーション構造                                               │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│  │  グローバルナビゲーション（サイドバー）                                           │   │
│  ├─────────────────────────────────────────────────────────────────────────────────┤   │
│  │                                                                                 │   │
│  │  ┌─────────────────────────────┐                                               │   │
│  │  │  🏠 ダッシュボード           │ ← メイン画面、KPIサマリー                     │   │
│  │  ├─────────────────────────────┤                                               │   │
│  │  │  📌 検証作業                 │ ← セクションヘッダー                          │   │
│  │  │    🤖 推論実行               │                                              │   │
│  │  │    📊 結果管理               │                                              │   │
│  │  │    📋 レビュー               │ ← バッジで未評価件数表示                      │   │
│  │  ├─────────────────────────────┤                                               │   │
│  │  │  🔧 改善・分析               │ ← セクションヘッダー                          │   │
│  │  │    📝 プロンプト管理         │                                              │   │
│  │  │    💰 コスト分析             │                                              │   │
│  │  │    🔧 改善提案               │                                              │   │
│  │  ├─────────────────────────────┤                                               │   │
│  │  │  📁 データ・設定             │ ← セクションヘッダー                          │   │
│  │  │    📁 データ管理             │                                              │   │
│  │  │    ⚙️ 設定                   │                                              │   │
│  │  └─────────────────────────────┘                                               │   │
│  │                                                                                 │   │
│  │  ┌─────────────────────────────┐                                               │   │
│  │  │  フッター                    │                                               │   │
│  │  │  Provider: [Mock ▼]         │ ← LLMプロバイダー切替                         │   │
│  │  │  Status: 🟢 Ready           │                                               │   │
│  │  └─────────────────────────────┘                                               │   │
│  │                                                                                 │   │
│  └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│  │  コンテキストナビゲーション（ページ内）                                           │   │
│  ├─────────────────────────────────────────────────────────────────────────────────┤   │
│  │  ・Tab: 同一コンテキスト内のビュー切替                                           │   │
│  │  ・パンくずリスト: 階層構造の明示                                                │   │
│  │  ・関連リンク: コンテキストに応じた遷移先提示                                    │   │
│  └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. ワイヤーフレーム設計

### 3.1 共通レイアウト

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              共通レイアウト構造                                            │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ┌──────────┬──────────────────────────────────────────────────────────────────────┐   │
│  │          │  Header Bar                                                          │   │
│  │          │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │          │  │ 📄 ページタイトル                          [Provider: Mock ▼]  │ │   │
│  │  サ      │  └────────────────────────────────────────────────────────────────┘ │   │
│  │  イ      ├──────────────────────────────────────────────────────────────────────┤   │
│  │  ド      │                                                                      │   │
│  │  バ      │  Main Content Area                                                   │   │
│  │  |      │                                                                      │   │
│  │  （      │  ・カード型レイアウト                                                │   │
│  │  220px   │  ・セクション区切りで整理                                            │   │
│  │  ）      │  ・余白：16px (基本) / 24px (セクション間)                          │   │
│  │          │                                                                      │   │
│  │          │                                                                      │   │
│  │          │                                                                      │   │
│  │          │                                                                      │   │
│  │          ├──────────────────────────────────────────────────────────────────────┤   │
│  │          │  Footer (Optional)                                                   │   │
│  │          │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │          │  │ 操作ボタン群 / ページネーション / ステータス表示               │ │   │
│  │          │  └────────────────────────────────────────────────────────────────┘ │   │
│  └──────────┴──────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│  【レスポンシブ対応】                                                                    │
│  ・最小幅: 1024px（Streamlit制約）                                                      │
│  ・サイドバー: 折りたたみ可                                                             │
│  ・カード: 2カラム → 1カラム（画面幅に応じて）                                          │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 ダッシュボード（/）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 🏠 ダッシュボード                                               [日付範囲: 過去7日 ▼]  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  KPIカード群                                                                      │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │ │
│  │  │ 実行件数    │ │ Layer1通過率│ │ ハルシ率    │ │ 平均コスト  │ │ 未評価件数  │ │ │
│  │  │    156件   │ │   92.3%    │ │   3.2%     │ │  ¥42/件    │ │    15件    │ │ │
│  │  │  ↑ 23件   │ │  ↑ 1.2%   │ │  ↓ 0.5%   │ │   → 0%    │ │  (urgent)  │ │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌────────────────────────────────────┐  ┌────────────────────────────────────────┐   │
│  │  📈 KPI推移グラフ                  │  │  📋 最新実行結果                       │   │
│  │                                    │  │                                        │   │
│  │  [Tab: 通過率 | ハルシ率 | コスト] │  │  ID    | 日時      | 評価 | コスト    │   │
│  │                                    │  │  #156  | 14:30     | ◯   | ¥45       │   │
│  │  100% ─────────────────────────    │  │  #155  | 14:15     | △   | ¥38       │   │
│  │   90% ─────・─────・─────────      │  │  #154  | 13:45     | ◯   | ¥42       │   │
│  │   80% ─────────────────────────    │  │  #153  | 13:30     | ×   | ¥51       │   │
│  │        1/18  1/19  1/20  1/21      │  │  #152  | 13:00     | ◯   | ¥39       │   │
│  │                                    │  │                                        │   │
│  │  (Plotlyグラフ)                    │  │            [すべて見る →]              │   │
│  └────────────────────────────────────┘  └────────────────────────────────────────┘   │
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  ⚠️ アラート                                                                      │ │
│  │                                                                                   │ │
│  │  • 01/22: プロンプトv3.2でハルシ率が5.1%に上昇（閾値5%超過）      [詳細を見る]   │ │
│  │  • 01/21: 人手評価の待機件数が15件に到達                          [レビューへ]   │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌────────────────────────────────────┐  ┌────────────────────────────────────────┐   │
│  │  🚀 クイックアクション              │  │  📊 プロンプトバージョン比較           │   │
│  │                                    │  │                                        │   │
│  │  [🤖 推論実行]  [📋 レビュー開始]  │  │  v3.2: 精度 4.2  コスト ¥45           │   │
│  │                                    │  │  v3.1: 精度 4.0  コスト ¥42           │   │
│  │  [📝 プロンプト編集]  [📁 データ]  │  │  v3.0: 精度 3.8  コスト ¥38 (固定)    │   │
│  │                                    │  │                                        │   │
│  └────────────────────────────────────┘  └────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 推論実行画面（/execution）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 🤖 推論実行                                                    [Provider: Mock 🟢]     │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  [Tab: 単発実行 ✓] [バッチ実行] [対話ブラッシュアップ]                                   │
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  📋 入力設定                                                                      │ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────┐  ┌─────────────────────────────────────────┐│ │
│  │  │ テストケース選択                 │  │ 実行設定                               ││ │
│  │  │                                 │  │                                         ││ │
│  │  │ [ケース選択 ▼]                  │  │ プロンプト: [v3.2 (latest) ▼]          ││ │
│  │  │  ◯ 既存ケースから選択          │  │ □ バージョン固定                       ││ │
│  │  │  ◯ カスタム入力                │  │                                         ││ │
│  │  │                                 │  │ ナレッジ: [デフォルト ▼]               ││ │
│  │  │                                 │  │ [+ カスタム追加]                        ││ │
│  │  └─────────────────────────────────┘  └─────────────────────────────────────────┘│ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ 企業情報                                                           [折畳 ▼]│ │ │
│  │  ├─────────────────────────────────────────────────────────────────────────────┤ │ │
│  │  │ 株式会社サンプル商事                                                        │ │ │
│  │  │ 業種: 卸売業 / 年商: 50億円 / 従業員: 120名                                 │ │ │
│  │  │ ...                                                                         │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ 面談記録（聴取情報）                                               [折畳 ▼]│ │ │
│  │  ├─────────────────────────────────────────────────────────────────────────────┤ │ │
│  │  │ 2025/01/15 訪問メモ                                                         │ │ │
│  │  │ 社長より海外展開に関心があるとの話あり...                                   │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ ★ 経営アジェンダシート                                            [折畳 ▼]│ │ │
│  │  ├─────────────────────────────────────────────────────────────────────────────┤ │ │
│  │  │ 【経営課題】 海外展開、コスト削減、事業承継                                  │ │ │
│  │  │ 【優先事項】 1. 海外展開の資金確保  2. 後継者育成...                         │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ ★ キーパーソンマップ                                              [折畳 ▼]│ │ │
│  │  ├─────────────────────────────────────────────────────────────────────────────┤ │ │
│  │  │ 【キーマン】 社長（意思決定者）、常務A（実務責任者）、経理部長               │ │ │
│  │  │ 【関係性】 社長-常務A: 信頼◎ / 当社-経理部長: 関係良好                      │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                   │ │
│  │                                          [実行 🚀]                                │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  📤 実行結果                                                        [展開/折畳] │ │
│  │                                                                                   │ │
│  │  ステータス: ✅ 完了 (3.2秒)   コスト: ¥42                                       │ │
│  │                                                                                   │ │
│  │  ┌── Step 1: ニーズ推定 ──────────────────────────────────────────────────────┐ │ │
│  │  │  ⏱️ 1.8秒 | 📊 1,245 tokens | 💰 ¥18                                       │ │ │
│  │  │                                                                             │ │ │
│  │  │  【推定ニーズ】                                                             │ │ │
│  │  │  1. 海外展開支援 (優先度: 高)                                               │ │ │
│  │  │     根拠: 社長が海外展開に関心、アジア市場開拓の意向                        │ │ │
│  │  │  2. 資金調達 (優先度: 中)                                                   │ │ │
│  │  │     根拠: 設備投資計画あり、現状の借入余力から追加融資が必要                │ │ │
│  │  │  [JSONを見る]                                                               │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                    ▼                                              │ │
│  │  ┌── Step 2: ソリューション伴奏 ─────────────────────────────────────────────┐ │ │
│  │  │  ⏱️ 1.4秒 | 📊 1,890 tokens | 💰 ¥24                                       │ │ │
│  │  │                                                                             │ │ │
│  │  │  【提案方針】                                                               │ │ │
│  │  │  海外展開ニーズに対し、まず貿易金融サービスを軸に提案...                    │ │ │
│  │  │                                                                             │ │ │
│  │  │  【推薦商材】                                                               │ │ │
│  │  │  1. 海外送金サービス / 2. 貿易保険 / 3. 設備投資融資                        │ │ │
│  │  │                                                                             │ │ │
│  │  │  ★【ネクストアクション】                                                   │ │ │
│  │  │  ┌───────────────────────────────────────────────────────────────────────┐│ │ │
│  │  │  │ 📋 経営アジェンダ深掘り                                               ││ │ │
│  │  │  │   • 海外展開の具体的な時期・地域を次回面談で確認                       ││ │ │
│  │  │  │   • 質問例「海外展開は何年後を想定されていますか」                     ││ │ │
│  │  │  │                                                                       ││ │ │
│  │  │  │ 🤝 キーパーソン関係深化                                               ││ │ │
│  │  │  │   • 常務Aとの接点を増やすことを推奨                                   ││ │ │
│  │  │  │   • アプローチ案: 業界動向レポートの提供                              ││ │ │
│  │  │  └───────────────────────────────────────────────────────────────────────┘│ │ │
│  │  │                                                                             │ │ │
│  │  │  ★【アカウントプラン更新提案】                                             │ │ │
│  │  │  経営アジェンダに「海外展開の時期」を追加項目として追記を推奨              │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                    ▼                                              │ │
│  │  ┌── Step 3: 自動評価 (Layer1) ───────────────────────────────────────────────┐ │ │
│  │  │  ハルシネーション: ✅ Pass  | 論理整合性: ✅ Pass                           │ │ │
│  │  │  ニーズ網羅性: 4/5 (◯)     | 根拠妥当性: 4/5 (◯)                           │ │ │
│  │  │  総合評価: ◯                                                                │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                   │ │
│  │  [詳細を見る] [JSONダウンロード ↓] [人手評価へ →]                                │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 レビュー画面（/review）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 📋 レビュー（人手評価）                                        評価進捗: 15/50件 (30%)  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  フィルタ・並び替え                                                               │ │
│  │  表示: [◯ 未評価のみ | すべて]   並び順: [自動評価スコア ▼]   [🔍 検索]          │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌────────────────────────────────────────────────────────────────┐ ← 左パネル        │
│  │  評価対象一覧                                    [35件 未評価] │                    │
│  │                                                                │                    │
│  │  ┌──────────────────────────────────────────────────────────┐ │                    │
│  │  │ #153 ○○商事                              △ (3.2) ◀選択中 │ │                    │
│  │  └──────────────────────────────────────────────────────────┘ │                    │
│  │  ┌──────────────────────────────────────────────────────────┐ │                    │
│  │  │ #148 △△工業                              × (2.1)        │ │                    │
│  │  └──────────────────────────────────────────────────────────┘ │                    │
│  │  ┌──────────────────────────────────────────────────────────┐ │                    │
│  │  │ #145 □□サービス                          ◯ (4.5) ✓済    │ │                    │
│  │  └──────────────────────────────────────────────────────────┘ │                    │
│  │  ...                                                          │                    │
│  └────────────────────────────────────────────────────────────────┘                    │
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  📝 評価入力: #153 ○○商事                                                        │ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────┐  ┌─────────────────────────────────────────────┐│ │
│  │  │ 【入力情報】                │  │ 【AI出力】                                  ││ │
│  │  │                             │  │                                             ││ │
│  │  │ 企業: ○○商事               │  │ 【推定ニーズ】                              ││ │
│  │  │ 業種: 卸売業                │  │ 1. 海外展開支援（高）                       ││ │
│  │  │ 年商: 50億円                │  │ 2. 資金調達（中）                           ││ │
│  │  │                             │  │ 3. 事業承継（中）                           ││ │
│  │  │ 【面談記録】                │  │                                             ││ │
│  │  │ 社長より海外展開に関心...   │  │ 【提案方針】                                ││ │
│  │  │                             │  │ 海外展開ニーズに対し、貿易金融を軸に...    ││ │
│  │  │                             │  │                                             ││ │
│  │  │ [全文表示]                  │  │ [JSONを見る]                                ││ │
│  │  └─────────────────────────────┘  └─────────────────────────────────────────────┘│ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ 【評価入力】                                                 ショートカット:│ │ │
│  │  │                                                              1:◯ 2:△ 3:×  │ │ │
│  │  │ 総合評価:  (◯) そのまま使える  (△) 参考になる  (×) 使えない             │ │ │
│  │  │                                                                             │ │ │
│  │  │ 観点別評価:                                                                 │ │ │
│  │  │ ├─ ニーズ網羅性:    [◯ ▼]   コメント: [                              ]    │ │ │
│  │  │ ├─ 根拠の妥当性:    [△ ▼]   コメント: [証跡が弱い部分あり            ]    │ │ │
│  │  │ ├─ 実用性:          [◯ ▼]   コメント: [                              ]    │ │ │
│  │  │ └─ 提案の適切さ:    [◯ ▼]   コメント: [                              ]    │ │ │
│  │  │                                                                             │ │ │
│  │  │ 総合コメント:                                                               │ │ │
│  │  │ ┌─────────────────────────────────────────────────────────────────────────┐│ │ │
│  │  │ │ 海外展開のニーズは的確。事業承継は優先度上げても良い。                  ││ │ │
│  │  │ └─────────────────────────────────────────────────────────────────────────┘│ │ │
│  │  │                                                                             │ │ │
│  │  │                         [スキップ] [前へ ←] [保存して次へ → (Enter)]        │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 プロンプト管理画面（/prompts）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 📝 プロンプト管理                                                                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  プロンプト一覧                                                      [+ 新規作成]│ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ 名前                      │ 用途          │ 最新ver │ 固定ver │ 更新日     │ │ │
│  │  │─────────────────────────────────────────────────────────────────────────────│ │ │
│  │  │ needs_estimation_v1       │ AI① ニーズ推定│ v3.2    │ v3.0🔒  │ 01/22     │ │ │
│  │  │ solution_recommendation_v1│ AI② ソリューション│ v2.5  │ -       │ 01/20     │ │ │
│  │  │ evaluation_v1             │ 評価用        │ v1.3    │ v1.0🔒  │ 01/18     │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  📄 プロンプト詳細: needs_estimation_v1                                           │ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ バージョン履歴                                                              │ │ │
│  │  │                                                                             │ │ │
│  │  │ ver   │ 日時          │ 変更者 │ タグ     │ 精度(平均) │ コスト │ 操作    │ │ │
│  │  │───────────────────────────────────────────────────────────────────────────│ │ │
│  │  │ v3.2  │ 01/22 14:00   │ 田中   │ latest   │ 4.2       │ ¥45   │[編集][固定]│ │ │
│  │  │ v3.1  │ 01/21 10:30   │ 田中   │          │ 4.0       │ ¥42   │[編集][固定]│ │ │
│  │  │ v3.0  │ 01/20 09:00   │ 鈴木   │ 🔒固定   │ 3.8       │ ¥38   │[編集][解除]│ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ 差分表示: v3.1 → v3.2                                                       │ │ │
│  │  │                                                                             │ │ │
│  │  │  @@ -15,7 +15,9 @@                                                          │ │ │
│  │  │   あなたは顧客ニーズ推定の専門家です。                                      │ │ │
│  │  │   以下の情報を分析し、潜在的なニーズを推定してください。                    │ │ │
│  │  │                                                                             │ │ │
│  │  │  -推定にあたっては、過去の類似事例を参考にしてください。                    │ │ │
│  │  │  +推定にあたっては、以下の観点を重視してください：                          │ │ │
│  │  │  +1. 過去の類似事例との比較                                                 │ │ │
│  │  │  +2. 業界特有のニーズパターン                                               │ │ │
│  │  │  +3. 企業のライフステージ                                                   │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                                   │ │
│  │  [編集] [A/Bテスト設定] [バージョン間比較]                                        │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  📊 パフォーマンス比較（v3.0 vs v3.2）                                            │ │
│  │                                                                                   │ │
│  │  ┌────────────────────────────────┐  ┌────────────────────────────────────────┐ │ │
│  │  │      精度スコア推移            │  │      コスト推移                        │ │ │
│  │  │  5 ─         ・・・v3.2       │  │  ¥50 ─    ・・・v3.2                  │ │ │
│  │  │  4 ─   ・・・・               │  │  ¥40 ─ ・・・・・v3.0                 │ │ │
│  │  │  3 ─ ・・・・v3.0             │  │  ¥30 ─                                │ │ │
│  │  │      ──────────────            │  │      ──────────────                    │ │ │
│  │  └────────────────────────────────┘  └────────────────────────────────────────┘ │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.6 コスト分析画面（/cost）

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 💰 コスト・パフォーマンス分析                                    [期間: 過去7日 ▼]     │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  サマリーカード                                                                   │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                 │ │
│  │  │ 総コスト    │ │ 平均コスト  │ │ 平均レイテンシ│ │ 総トークン  │                 │ │
│  │  │  ¥6,552    │ │  ¥42/件    │ │   3.2秒     │ │  2.1M      │                 │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘                 │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  📊 プロセス別内訳                                                                │ │
│  │                                                                                   │ │
│  │  プロセス             │ 平均コスト │ 平均時間 │ 平均トークン │ 割合              │ │
│  │  ─────────────────────────────────────────────────────────────────────────────── │ │
│  │  AI① ニーズ推定      │ ¥18       │ 1.8秒    │ 1,250       │ ███████    43%   │ │
│  │  AI② ソリューション  │ ¥24       │ 1.4秒    │ 1,900       │ █████████  57%   │ │
│  │  自動評価 (Layer1)    │ ¥8        │ 0.8秒    │ 650         │ ██         別計  │ │
│  │  ─────────────────────────────────────────────────────────────────────────────── │ │
│  │  合計                 │ ¥50       │ 4.0秒    │ 3,800       │ 100%              │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌────────────────────────────────────┐  ┌────────────────────────────────────────┐   │
│  │  📈 コスト推移グラフ               │  │  📈 レイテンシ推移グラフ               │   │
│  │                                    │  │                                        │   │
│  │  ¥60 ─                             │  │  5s ─                                  │   │
│  │  ¥50 ─    ・─・─・───・            │  │  4s ─    ・───・─・                    │   │
│  │  ¥40 ─ ・─            ─・─・       │  │  3s ─ ・─         ─・─・               │   │
│  │  ¥30 ─                             │  │  2s ─                                  │   │
│  │       1/16  1/18  1/20  1/22       │  │       1/16  1/18  1/20  1/22          │   │
│  │                                    │  │                                        │   │
│  │  [凡例: ─── 平均  ─・─ プロンプト変更]│  │                                        │   │
│  └────────────────────────────────────┘  └────────────────────────────────────────┘   │
│                                                                                         │
│  ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│  │  ⚙️ プロンプトバージョン別分析                                                    │ │
│  │                                                                                   │ │
│  │  バージョン │ 平均コスト │ 平均精度  │ コスパ (精度/コスト) │ 実行数              │ │
│  │  ─────────────────────────────────────────────────────────────────────────────── │ │
│  │  v3.2       │ ¥45       │ 4.2/5     │ 0.093               │ 35件               │ │
│  │  v3.1       │ ¥42       │ 4.0/5     │ 0.095               │ 48件               │ │
│  │  v3.0 🔒    │ ¥38       │ 3.8/5     │ 0.100 ★ベスト       │ 73件               │ │
│  │                                                                                   │ │
│  │  ※コスパ = 精度 / コスト（高いほど効率的）                                        │ │
│  └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  [CSVエクスポート ↓] [レポート生成]                                                     │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Streamlitコンポーネント設計

### 4.1 ディレクトリ構造

```
ui/
├── streamlit/
│   ├── app.py                      # エントリポイント（マルチページ設定）
│   ├── config.py                   # UI設定
│   ├── state.py                    # セッション状態管理
│   │
│   ├── pages/
│   │   ├── 01_🏠_Dashboard.py      # ダッシュボード
│   │   ├── 02_🤖_Execution.py      # 推論実行
│   │   ├── 03_📊_Results.py        # 結果管理
│   │   ├── 04_📋_Review.py         # レビュー（人手評価）
│   │   ├── 05_📝_Prompts.py        # プロンプト管理
│   │   ├── 06_📁_Data.py           # データ管理
│   │   ├── 07_💰_Cost.py           # コスト分析
│   │   ├── 08_🔧_Improvements.py   # 改善提案
│   │   └── 09_⚙️_Settings.py       # 設定
│   │
│   ├── components/                 # 再利用可能コンポーネント
│   │   ├── __init__.py
│   │   ├── cards/
│   │   │   ├── kpi_card.py         # KPIカード
│   │   │   ├── result_card.py      # 結果表示カード
│   │   │   └── alert_card.py       # アラートカード
│   │   │
│   │   ├── forms/
│   │   │   ├── execution_form.py   # 推論実行フォーム
│   │   │   ├── review_form.py      # 評価入力フォーム
│   │   │   └── prompt_editor.py    # プロンプトエディタ
│   │   │
│   │   ├── displays/
│   │   │   ├── process_output.py   # プロセス出力表示
│   │   │   ├── diff_viewer.py      # 差分ビューア
│   │   │   └── json_viewer.py      # JSON表示
│   │   │
│   │   ├── charts/
│   │   │   ├── kpi_trend.py        # KPI推移グラフ
│   │   │   ├── cost_breakdown.py   # コスト内訳チャート
│   │   │   └── version_compare.py  # バージョン比較チャート
│   │   │
│   │   └── common/
│   │       ├── sidebar.py          # サイドバー
│   │       ├── header.py           # ヘッダー
│   │       ├── pagination.py       # ページネーション
│   │       └── filters.py          # フィルタUI
│   │
│   ├── services/                   # UIからバックエンドへの接続
│   │   ├── api_client.py           # FastAPI呼び出し
│   │   └── mock_client.py          # Mock用クライアント
│   │
│   └── styles/
│       └── custom.css              # カスタムCSS
```

### 4.2 主要コンポーネント仕様

#### 4.2.1 KPIカード

```python
# ui/streamlit/components/cards/kpi_card.py

import streamlit as st
from dataclasses import dataclass
from typing import Literal

@dataclass
class KPIData:
    """KPIデータモデル"""
    label: str
    value: str | float
    unit: str = ""
    delta: float | None = None
    delta_color: Literal["normal", "inverse", "off"] = "normal"

def kpi_card(data: KPIData, key: str | None = None):
    """
    KPIカードコンポーネント

    使用例:
        kpi_card(KPIData(
            label="Layer1通過率",
            value=92.3,
            unit="%",
            delta=1.2,
            delta_color="normal"
        ))
    """
    st.metric(
        label=data.label,
        value=f"{data.value}{data.unit}",
        delta=f"{data.delta:+.1f}{data.unit}" if data.delta is not None else None,
        delta_color=data.delta_color,
        key=key
    )

def kpi_cards_row(kpis: list[KPIData]):
    """
    KPIカードを横並びで表示
    """
    cols = st.columns(len(kpis))
    for col, kpi in zip(cols, kpis):
        with col:
            kpi_card(kpi)
```

#### 4.2.2 プロセス出力表示

```python
# ui/streamlit/components/displays/process_output.py

import streamlit as st
from dataclasses import dataclass

@dataclass
class ProcessOutput:
    """プロセス出力データ"""
    name: str
    status: str  # "success" | "error" | "pending"
    duration_sec: float
    tokens: int
    cost_yen: float
    output: dict | str
    raw_json: dict | None = None

def process_step_card(output: ProcessOutput, expanded: bool = True):
    """
    プロセスステップの出力を折りたたみ可能なカードで表示

    使用例:
        process_step_card(ProcessOutput(
            name="ニーズ推定",
            status="success",
            duration_sec=1.8,
            tokens=1245,
            cost_yen=18,
            output={"needs": [...]}
        ))
    """
    status_emoji = {"success": "✅", "error": "❌", "pending": "⏳"}[output.status]

    with st.expander(
        f"{status_emoji} {output.name}  |  ⏱️ {output.duration_sec:.1f}秒  |  "
        f"📊 {output.tokens:,} tokens  |  💰 ¥{output.cost_yen:.0f}",
        expanded=expanded
    ):
        # 出力表示
        if isinstance(output.output, dict):
            _render_structured_output(output.output)
        else:
            st.write(output.output)

        # JSON表示ボタン
        if output.raw_json:
            if st.button("JSONを見る", key=f"json_{output.name}"):
                st.json(output.raw_json)

def _render_structured_output(data: dict):
    """構造化出力を読みやすく表示"""
    if "needs" in data:
        st.subheader("推定ニーズ")
        for i, need in enumerate(data["needs"], 1):
            priority_badge = {"高": "🔴", "中": "🟡", "低": "🟢"}.get(
                need.get("priority_label", ""), "⚪"
            )
            st.markdown(f"""
            **{i}. {need['category']}** {priority_badge}

            > {need['description']}

            *根拠*: {need['evidence']}
            """)
            st.divider()

    if "summary" in data:
        st.info(data["summary"])
```

#### 4.2.3 評価フォーム

```python
# ui/streamlit/components/forms/review_form.py

import streamlit as st
from dataclasses import dataclass
from typing import Callable

@dataclass
class ReviewResult:
    """評価結果"""
    overall_rating: str  # "◯" | "△" | "×"
    criteria_ratings: dict[str, str]  # {criteria_name: rating}
    criteria_comments: dict[str, str]  # {criteria_name: comment}
    overall_comment: str

def review_form(
    criteria: list[str],
    on_submit: Callable[[ReviewResult], None],
    on_skip: Callable[[], None] | None = None,
    key_prefix: str = ""
) -> ReviewResult | None:
    """
    人手評価入力フォーム

    使用例:
        result = review_form(
            criteria=["ニーズ網羅性", "根拠の妥当性", "実用性", "提案の適切さ"],
            on_submit=lambda r: save_review(r),
            on_skip=lambda: skip_current()
        )
    """
    with st.form(key=f"{key_prefix}_review_form"):
        # 総合評価
        st.subheader("総合評価")
        overall = st.radio(
            "この出力は？",
            options=["◯ そのまま使える", "△ 参考になる", "× 使えない"],
            horizontal=True,
            key=f"{key_prefix}_overall"
        )

        st.divider()

        # 観点別評価
        st.subheader("観点別評価")
        criteria_ratings = {}
        criteria_comments = {}

        for criterion in criteria:
            col1, col2 = st.columns([1, 2])
            with col1:
                criteria_ratings[criterion] = st.selectbox(
                    criterion,
                    options=["◯", "△", "×"],
                    key=f"{key_prefix}_{criterion}_rating"
                )
            with col2:
                criteria_comments[criterion] = st.text_input(
                    "コメント",
                    key=f"{key_prefix}_{criterion}_comment",
                    label_visibility="collapsed"
                )

        st.divider()

        # 総合コメント
        overall_comment = st.text_area(
            "総合コメント",
            placeholder="この評価に関する補足コメントを入力...",
            key=f"{key_prefix}_comment"
        )

        # ボタン
        col1, col2, col3 = st.columns([1, 1, 2])
        with col1:
            if on_skip and st.form_submit_button("スキップ"):
                on_skip()
                return None
        with col3:
            if st.form_submit_button("保存して次へ →", type="primary"):
                result = ReviewResult(
                    overall_rating=overall[0],  # "◯" | "△" | "×"
                    criteria_ratings=criteria_ratings,
                    criteria_comments=criteria_comments,
                    overall_comment=overall_comment
                )
                on_submit(result)
                return result

    return None
```

#### 4.2.4 プロンプトエディタ

```python
# ui/streamlit/components/forms/prompt_editor.py

import streamlit as st
from dataclasses import dataclass

@dataclass
class PromptEditorData:
    """プロンプトエディタデータ"""
    prompt_id: str
    name: str
    category: str
    system_prompt: str
    user_prompt_template: str
    input_variables: list[str]
    temperature: float = 0.3

def prompt_editor(
    data: PromptEditorData,
    on_save: Callable[[PromptEditorData], None],
    on_test: Callable[[PromptEditorData], None] | None = None,
    key_prefix: str = ""
):
    """
    プロンプト編集コンポーネント

    使用例:
        prompt_editor(
            data=current_prompt,
            on_save=lambda p: save_prompt_version(p),
            on_test=lambda p: test_with_mock(p)
        )
    """
    st.subheader(f"📝 {data.name} 編集")

    # メタ情報
    col1, col2 = st.columns(2)
    with col1:
        name = st.text_input("プロンプト名", value=data.name, key=f"{key_prefix}_name")
    with col2:
        temp = st.slider(
            "Temperature",
            min_value=0.0,
            max_value=1.0,
            value=data.temperature,
            step=0.1,
            key=f"{key_prefix}_temp"
        )

    # システムプロンプト
    st.markdown("**システムプロンプト**")
    system_prompt = st.text_area(
        "system_prompt",
        value=data.system_prompt,
        height=200,
        key=f"{key_prefix}_system",
        label_visibility="collapsed"
    )

    # ユーザープロンプトテンプレート
    st.markdown("**ユーザープロンプトテンプレート**")
    st.caption(f"利用可能な変数: {', '.join(['{' + v + '}' for v in data.input_variables])}")
    user_prompt = st.text_area(
        "user_prompt",
        value=data.user_prompt_template,
        height=300,
        key=f"{key_prefix}_user",
        label_visibility="collapsed"
    )

    # ボタン
    col1, col2, col3 = st.columns([1, 1, 2])
    with col1:
        if on_test and st.button("🧪 Mockでテスト", key=f"{key_prefix}_test"):
            updated = PromptEditorData(
                prompt_id=data.prompt_id,
                name=name,
                category=data.category,
                system_prompt=system_prompt,
                user_prompt_template=user_prompt,
                input_variables=data.input_variables,
                temperature=temp
            )
            on_test(updated)

    with col3:
        if st.button("💾 新バージョンとして保存", type="primary", key=f"{key_prefix}_save"):
            updated = PromptEditorData(
                prompt_id=data.prompt_id,
                name=name,
                category=data.category,
                system_prompt=system_prompt,
                user_prompt_template=user_prompt,
                input_variables=data.input_variables,
                temperature=temp
            )
            on_save(updated)
```

### 4.3 状態管理

```python
# ui/streamlit/state.py

import streamlit as st
from dataclasses import dataclass, field
from typing import Any

@dataclass
class AppState:
    """アプリケーション全体の状態"""

    # LLM設定
    llm_provider: str = "mock"

    # 現在の選択
    current_scenario_id: str | None = None
    current_prompt_id: str | None = None
    current_result_id: str | None = None

    # フィルタ状態
    date_range: tuple[str, str] | None = None
    review_filter: str = "未評価のみ"

    # キャッシュ
    cached_scenarios: list[dict] = field(default_factory=list)
    cached_results: list[dict] = field(default_factory=list)

def get_state() -> AppState:
    """セッション状態を取得（なければ初期化）"""
    if "app_state" not in st.session_state:
        st.session_state.app_state = AppState()
    return st.session_state.app_state

def set_state(**kwargs):
    """状態を更新"""
    state = get_state()
    for key, value in kwargs.items():
        if hasattr(state, key):
            setattr(state, key, value)

def clear_cache():
    """キャッシュをクリア"""
    state = get_state()
    state.cached_scenarios = []
    state.cached_results = []
```

### 4.4 APIクライアント

```python
# ui/streamlit/services/api_client.py

import httpx
from typing import Any
import streamlit as st

class APIClient:
    """FastAPIバックエンドへのクライアント"""

    def __init__(self, base_url: str = "http://localhost:8000"):
        self.base_url = base_url
        self.client = httpx.AsyncClient(base_url=base_url, timeout=60.0)

    async def execute_inference(
        self,
        scenario_id: str | None = None,
        company_info: str | None = None,
        hearing_info: str | None = None,
        prompt_version: str | None = None,
        use_mock: bool = False
    ) -> dict:
        """推論実行"""
        response = await self.client.post(
            "/api/v1/processes/execute",
            json={
                "scenario_id": scenario_id,
                "company_info": company_info,
                "hearing_info": hearing_info,
                "prompt_version": prompt_version,
                "use_mock": use_mock
            }
        )
        response.raise_for_status()
        return response.json()

    async def get_results(
        self,
        limit: int = 50,
        offset: int = 0,
        status_filter: str | None = None
    ) -> list[dict]:
        """結果一覧取得"""
        params = {"limit": limit, "offset": offset}
        if status_filter:
            params["status"] = status_filter

        response = await self.client.get("/api/v1/results", params=params)
        response.raise_for_status()
        return response.json()

    async def submit_review(
        self,
        result_id: str,
        overall_rating: str,
        criteria_ratings: dict[str, str],
        comments: dict[str, str],
        overall_comment: str
    ) -> dict:
        """評価結果を送信"""
        response = await self.client.post(
            f"/api/v1/results/{result_id}/review",
            json={
                "overall_rating": overall_rating,
                "criteria_ratings": criteria_ratings,
                "comments": comments,
                "overall_comment": overall_comment
            }
        )
        response.raise_for_status()
        return response.json()

    async def get_prompts(self, category: str | None = None) -> list[dict]:
        """プロンプト一覧取得"""
        params = {}
        if category:
            params["category"] = category

        response = await self.client.get("/api/v1/prompts", params=params)
        response.raise_for_status()
        return response.json()

    async def save_prompt_version(
        self,
        prompt_id: str,
        system_prompt: str,
        user_prompt_template: str,
        temperature: float
    ) -> dict:
        """新しいプロンプトバージョンを保存"""
        response = await self.client.post(
            f"/api/v1/prompts/{prompt_id}/versions",
            json={
                "system_prompt": system_prompt,
                "user_prompt_template": user_prompt_template,
                "temperature": temperature
            }
        )
        response.raise_for_status()
        return response.json()

    async def get_metrics(
        self,
        start_date: str,
        end_date: str,
        group_by: str = "day"
    ) -> dict:
        """メトリクス取得"""
        response = await self.client.get(
            "/api/v1/metrics",
            params={
                "start_date": start_date,
                "end_date": end_date,
                "group_by": group_by
            }
        )
        response.raise_for_status()
        return response.json()

@st.cache_resource
def get_api_client() -> APIClient:
    """シングルトンのAPIクライアントを取得"""
    return APIClient()
```

---

## 5. デザインシステム

### 5.1 カラーパレット

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          カラーパレット                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【Primary】                                                                │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐                                       │
│  │ #1f77b4 │ │ #4a9fd4 │ │ #a8d5f2 │                                       │
│  │ Primary │ │ Light   │ │ Lighter │                                       │
│  └─────────┘ └─────────┘ └─────────┘                                       │
│                                                                             │
│  【Semantic】                                                               │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                           │
│  │ #2ca02c │ │ #ff7f0e │ │ #d62728 │ │ #7f7f7f │                           │
│  │ Success │ │ Warning │ │ Error   │ │ Neutral │                           │
│  │  (◯)   │ │  (△)    │ │  (×)    │ │         │                           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘                           │
│                                                                             │
│  【Background】                                                             │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐                                       │
│  │ #ffffff │ │ #f5f5f5 │ │ #e0e0e0 │                                       │
│  │ White   │ │ Light   │ │ Border  │                                       │
│  └─────────┘ └─────────┘ └─────────┘                                       │
│                                                                             │
│  【Text】                                                                   │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐                                       │
│  │ #212121 │ │ #757575 │ │ #bdbdbd │                                       │
│  │ Primary │ │ Second  │ │ Hint    │                                       │
│  └─────────┘ └─────────┘ └─────────┘                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 タイポグラフィ

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          タイポグラフィ                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【フォントファミリー】                                                      │
│  日本語: "Noto Sans JP", sans-serif                                         │
│  英数字: "Inter", -apple-system, sans-serif                                 │
│  コード: "JetBrains Mono", "Consolas", monospace                            │
│                                                                             │
│  【サイズスケール】                                                          │
│  h1: 28px / 1.2 / Bold     ← ページタイトル                                 │
│  h2: 22px / 1.3 / SemiBold ← セクションタイトル                              │
│  h3: 18px / 1.4 / Medium   ← カードタイトル                                  │
│  body: 14px / 1.5 / Regular ← 本文                                          │
│  small: 12px / 1.4 / Regular ← 補足情報                                     │
│  caption: 11px / 1.3 / Regular ← キャプション                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.3 スペーシング

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          スペーシングシステム                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【基本単位】 8px ベース                                                     │
│                                                                             │
│  xs: 4px   ← アイコンと文字の間                                             │
│  sm: 8px   ← 関連要素間                                                     │
│  md: 16px  ← 要素間（デフォルト）                                           │
│  lg: 24px  ← セクション間                                                   │
│  xl: 32px  ← 大きなセクション間                                             │
│  xxl: 48px ← ページセクション間                                             │
│                                                                             │
│  【コンテナパディング】                                                      │
│  カード内: 16px                                                             │
│  ページ: 24px                                                               │
│  モーダル: 24px                                                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. インタラクション設計

### 6.1 キーボードショートカット

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          キーボードショートカット                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【グローバル】                                                              │
│  /           → 検索にフォーカス                                             │
│  g + d       → ダッシュボードへ                                             │
│  g + e       → 推論実行へ                                                   │
│  g + r       → レビューへ                                                   │
│  g + p       → プロンプト管理へ                                             │
│                                                                             │
│  【レビュー画面】                                                            │
│  1           → ◯評価                                                       │
│  2           → △評価                                                       │
│  3           → ×評価                                                       │
│  Enter       → 保存して次へ                                                 │
│  s           → スキップ                                                     │
│  ←/→        → 前/次の項目                                                  │
│                                                                             │
│  【プロンプトエディタ】                                                      │
│  Ctrl+S      → 保存                                                         │
│  Ctrl+Enter  → テスト実行                                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 ローディング・エラー状態

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          状態表示パターン                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【ローディング】                                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ⏳ 推論を実行中...                                                   │   │
│  │  ┌───────────────────────────────────────────────────────────────┐   │   │
│  │  │ Step 1: ニーズ推定     ████████████████████░░░░░░░░  70%      │   │   │
│  │  │ Step 2: ソリューション  ░░░░░░░░░░░░░░░░░░░░░░░░░░░  待機中    │   │   │
│  │  │ Step 3: 評価           ░░░░░░░░░░░░░░░░░░░░░░░░░░░  待機中    │   │   │
│  │  └───────────────────────────────────────────────────────────────┘   │   │
│  │  経過時間: 1.2秒                              [キャンセル]            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  【エラー】                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ❌ エラーが発生しました                                              │   │
│  │                                                                     │   │
│  │  LLM APIからの応答でエラーが発生しました。                            │   │
│  │  Error: Rate limit exceeded                                         │   │
│  │                                                                     │   │
│  │  [再試行] [詳細を見る] [Mockで再実行]                                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  【空状態】                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │                         📭                                          │   │
│  │                                                                     │   │
│  │              まだ実行結果がありません                                 │   │
│  │                                                                     │   │
│  │       最初の推論を実行して、結果を確認しましょう                       │   │
│  │                                                                     │   │
│  │                    [推論を実行する →]                                │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 実装ロードマップ

### 7.1 フェーズ別実装計画

```
Phase 1: 基本UI (Week 1)
├── 共通レイアウト・ナビゲーション
├── ダッシュボード（KPIカード、サマリー）
├── 推論実行（単発実行）
└── 結果表示（基本）

Phase 2: 評価機能 (Week 2)
├── レビュー画面（一覧・詳細）
├── 評価入力フォーム
├── 結果詳細画面
└── キーボードショートカット

Phase 3: 管理機能 (Week 3)
├── プロンプト管理（一覧・編集）
├── バージョン履歴・差分表示
├── データ管理（ナレッジ・商材）
└── インポート/エクスポート

Phase 4: 分析機能 (Week 4)
├── コスト分析ダッシュボード
├── グラフ・チャート実装
├── 改善提案画面
└── レポート出力

Phase 5: 最適化 (Week 5)
├── パフォーマンス最適化
├── エラーハンドリング強化
├── UXテスト・改善
└── ドキュメント整備
```

---

## 8. 変更履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| v1.0 | 2026-01-23 | 初版作成（UX設計・IA・ワイヤーフレーム・コンポーネント設計） |
| v1.1 | 2026-01-25 | 伴奏AI対応: 推論実行画面に経営アジェンダシート・キーパーソンマップ入力追加、出力にネクストアクション・アカウントプラン更新提案表示追加 |
